<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Antigravity API ç®¡ç†æ§åˆ¶å°</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --secondary: #8b5cf6;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --info: #3b82f6;
      --dark: #1e293b;
      --light: #f8fafc;
      --gray: #64748b;
      --border: #e2e8f0;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #f0f4ff 0%, #faf5ff 50%, #fef3f2 100%);
      min-height: 100vh;
      color: var(--dark);
      line-height: 1.6;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 24px;
    }

    .header {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #a855f7 100%);
      padding: 48px 40px;
      border-radius: 24px;
      box-shadow: var(--shadow-xl), 0 0 40px rgba(99, 102, 241, 0.3);
      margin-bottom: 32px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .header::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);
      animation: pulse 15s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 0.5; }
      50% { transform: scale(1.1); opacity: 0.3; }
    }

    .header h1 {
      color: #ffffff;
      font-size: 2.5em;
      margin-bottom: 12px;
      font-weight: 700;
      letter-spacing: -0.5px;
      position: relative;
    }

    .header p {
      color: rgba(255, 255, 255, 0.9);
      font-size: 1.1em;
      font-weight: 400;
      position: relative;
    }

    .nav-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 28px;
      flex-wrap: wrap;
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(10px);
      padding: 12px;
      border-radius: 16px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255, 255, 255, 0.5);
    }

    .nav-tab {
      background: transparent;
      border: none;
      padding: 12px 20px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 0.95em;
      font-weight: 600;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      color: var(--gray);
      position: relative;
      overflow: hidden;
    }

    .nav-tab:hover {
      background: rgba(99, 102, 241, 0.1);
      color: var(--primary);
      transform: translateY(-1px);
    }

    .nav-tab.active {
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
    }

    .tab-content {
      display: none;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      padding: 32px;
      border-radius: 20px;
      box-shadow: var(--shadow-lg);
      border: 1px solid rgba(255, 255, 255, 0.5);
    }

    .tab-content.active {
      display: block;
      animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes slideOut {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(100%);
        opacity: 0;
      }
    }

    .card {
      background: linear-gradient(135deg, #ffffff 0%, #fafbff 100%);
      padding: 28px;
      border-radius: 16px;
      margin-bottom: 24px;
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: linear-gradient(180deg, var(--primary) 0%, var(--secondary) 100%);
      border-radius: 4px 0 0 4px;
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .card h3 {
      color: var(--dark);
      margin-bottom: 16px;
      font-size: 1.25em;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #2c3e50;
      font-size: 0.95em;
    }

    input, textarea, select {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid var(--border);
      border-radius: 12px;
      font-size: 0.95em;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      background: #ffffff;
      color: var(--dark);
    }

    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
    }

    input:hover, textarea:hover, select:hover {
      border-color: #c7d2fe;
    }

    textarea {
      resize: vertical;
      min-height: 100px;
      font-family: 'JetBrains Mono', 'Fira Code', 'Courier New', monospace;
    }

    button {
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 10px;
      font-size: 0.95em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 2px 8px rgba(99, 102, 241, 0.25);
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(99, 102, 241, 0.4);
    }

    button:active {
      transform: translateY(0);
      box-shadow: 0 2px 8px rgba(99, 102, 241, 0.25);
    }

    button:disabled {
      background: linear-gradient(135deg, #94a3b8 0%, #64748b 100%);
      cursor: not-allowed;
      transform: none;
      opacity: 0.7;
      box-shadow: none;
    }

    .btn-danger {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      box-shadow: 0 2px 8px rgba(239, 68, 68, 0.25);
    }

    .btn-danger:hover {
      box-shadow: 0 8px 20px rgba(239, 68, 68, 0.4);
    }

    .btn-secondary {
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.25);
    }

    .btn-secondary:hover {
      box-shadow: 0 8px 20px rgba(59, 130, 246, 0.4);
    }

    .btn-success {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      box-shadow: 0 2px 8px rgba(16, 185, 129, 0.25);
    }

    .btn-success:hover {
      box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
    }

    .btn-warning {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      box-shadow: 0 2px 8px rgba(245, 158, 11, 0.25);
    }

    .btn-warning:hover {
      box-shadow: 0 8px 20px rgba(245, 158, 11, 0.4);
    }

    .key-list {
      list-style: none;
    }

    .key-item {
      background: #f8f9fa;
      padding: 20px;
      margin-bottom: 12px;
      border-radius: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: 1px solid #e9ecef;
      transition: all 0.2s;
    }

    .key-item:hover {
      border-color: #667eea;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15);
    }

    .key-value {
      font-family: 'Courier New', monospace;
      background: #ffffff;
      padding: 10px 15px;
      border-radius: 6px;
      flex: 1;
      margin-right: 15px;
      overflow-x: auto;
      border: 1px solid #e9ecef;
      color: #2c3e50;
      font-size: 0.95em;
    }

    .log-entry {
      padding: 12px 15px;
      margin-bottom: 8px;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
      color: #2c3e50;
    }

    .log-info { background: #e8f4fd; border-left: 4px solid #3498db; }
    .log-warn { background: #fff9e6; border-left: 4px solid #f39c12; }
    .log-error { background: #fde8e8; border-left: 4px solid #e74c3c; }
    .log-success { background: #e8f8f0; border-left: 4px solid #27ae60; }

    .status-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }

    .status-card {
      background: linear-gradient(135deg, #ffffff 0%, #f8faff 100%);
      padding: 28px;
      border-radius: 16px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .status-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
    }

    .status-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
    }

    .status-card h3 {
      font-size: 0.8em;
      margin-bottom: 12px;
      color: var(--gray);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .status-card .value {
      font-size: 2em;
      font-weight: 800;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .api-endpoint {
      background: #ffffff;
      padding: 25px;
      border-radius: 10px;
      margin-bottom: 20px;
      border: 1px solid #e9ecef;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .api-endpoint h4 {
      color: #2c3e50;
      margin-bottom: 12px;
      font-size: 1.2em;
    }

    .api-endpoint p {
      color: #5a6c7d;
      margin-bottom: 15px;
    }

    .code-block {
      background: #2c3e50;
      color: #ecf0f1;
      padding: 18px 20px;
      border-radius: 8px;
      overflow-x: auto;
      font-family: 'Courier New', monospace;
      margin: 10px 0;
      font-size: 0.9em;
      line-height: 1.6;
      border: 1px solid #34495e;
    }

    .test-result {
      margin-top: 20px;
      padding: 20px;
      border-radius: 8px;
      background: #f8f9fa;
      border: 1px solid #e9ecef;
    }

    .alert {
      padding: 16px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-weight: 500;
    }

    .alert-success { background: #d5f5e3; color: #186a3b; border: 1px solid #a9dfbf; }
    .alert-error { background: #fadbd8; color: #922b21; border: 1px solid #f5b7b1; }
    .alert-info { background: #d6eaf8; color: #1b4f72; border: 1px solid #aed6f1; }

    .flex-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    #chatMessages {
      max-height: 400px;
      overflow-y: auto;
      background: #ffffff;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 15px;
      border: 1px solid #e9ecef;
    }

    .message {
      margin-bottom: 15px;
      padding: 12px 18px;
      border-radius: 10px;
      max-width: 80%;
      line-height: 1.5;
    }

    .message.user {
      background: #667eea;
      color: white;
      margin-left: auto;
      box-shadow: 0 2px 4px rgba(102, 126, 234, 0.2);
    }

    .message.assistant {
      background: #f8f9fa;
      color: #2c3e50;
      border: 1px solid #e9ecef;
    }

    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    code {
      background: #f8f9fa;
      padding: 3px 8px;
      border-radius: 4px;
      color: #667eea;
      font-weight: 600;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
    }

    .token-item {
      background: #f8f9fa;
      padding: 20px;
      margin-bottom: 12px;
      border-radius: 10px;
      border: 1px solid #e9ecef;
      transition: all 0.2s;
    }

    .token-item:hover {
      border-color: #667eea;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15);
    }

    .auto-refresh {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: #f8f9fa;
      border-radius: 8px;
      font-size: 0.9em;
    }

    .auto-refresh input[type="checkbox"] {
      width: auto;
      margin: 0;
    }

    /* ç™»å½•é®ç½©å±‚ */
    .login-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #a855f7 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    .login-overlay::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Ccircle cx='30' cy='30' r='2'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    }

    .login-overlay.hidden {
      display: none;
    }

    .login-box {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      padding: 48px 40px;
      border-radius: 24px;
      box-shadow: 0 25px 80px rgba(0,0,0,0.35);
      width: 100%;
      max-width: 420px;
      text-align: center;
      position: relative;
      border: 1px solid rgba(255, 255, 255, 0.5);
    }

    .login-box h2 {
      color: var(--dark);
      margin-bottom: 8px;
      font-size: 2em;
      font-weight: 700;
    }

    .login-box p {
      color: var(--gray);
      margin-bottom: 32px;
      font-size: 1em;
    }

    .login-box .form-group {
      text-align: left;
    }

    .login-box input[type="password"] {
      text-align: center;
      font-size: 1.1em;
      letter-spacing: 3px;
      padding: 16px;
    }

    .login-box button {
      width: 100%;
      padding: 16px;
      font-size: 1.1em;
      margin-top: 8px;
    }


    textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid var(--border);
      border-radius: 12px;
      font-size: 0.9em;
      font-family: 'Courier New', monospace;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      background: #ffffff;
      color: var(--dark);
      resize: vertical;
      min-height: 80px;
    }

    textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }

    .login-error {
      color: var(--danger);
      margin-top: 16px;
      font-size: 0.9em;
      font-weight: 500;
    }

    /* ç™»å‡ºæŒ‰é’® */
    .logout-btn {
      background: rgba(255, 255, 255, 0.2) !important;
      backdrop-filter: blur(10px);
      padding: 10px 20px !important;
      font-size: 0.9em !important;
      border: 1px solid rgba(255, 255, 255, 0.3) !important;
      box-shadow: none !important;
    }

    .logout-btn:hover {
      background: rgba(255, 255, 255, 0.3) !important;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1) !important;
    }

    .header-actions {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-top: 20px;
      position: relative;
    }

    /* æ»šåŠ¨æ¡ç¾åŒ– */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #f1f5f9;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, var(--primary) 0%, var(--secondary) 100%);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(180deg, var(--primary-dark) 0%, var(--primary) 100%);
    }

    /* é¦–é¡µæ•°æ®é¢æ¿æ ·å¼ */
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 28px;
    }

    .dash-card {
      background: white;
      border-radius: 20px;
      padding: 28px;
      display: flex;
      align-items: center;
      gap: 20px;
      box-shadow: var(--shadow-lg);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .dash-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.05) 0%, rgba(139, 92, 246, 0.05) 100%);
      opacity: 0;
      transition: opacity 0.3s;
    }

    .dash-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-xl);
    }

    .dash-card:hover::before {
      opacity: 1;
    }

    .dash-icon {
      font-size: 3em;
      width: 80px;
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 16px;
      background: linear-gradient(135deg, #f0f4ff 0%, #faf5ff 100%);
      flex-shrink: 0;
    }

    .dash-card.dash-primary .dash-icon {
      background: linear-gradient(135deg, #e0e7ff 0%, #dbeafe 100%);
    }

    .dash-card.dash-success .dash-icon {
      background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
    }

    .dash-card.dash-warning .dash-icon {
      background: linear-gradient(135deg, #fed7aa 0%, #fde68a 100%);
    }

    .dash-card.dash-info .dash-icon {
      background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
    }

    .dash-content {
      flex: 1;
    }

    .dash-content h3 {
      font-size: 0.85em;
      color: var(--gray);
      margin-bottom: 8px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .dash-value {
      font-size: 2.2em;
      font-weight: 800;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      line-height: 1.2;
    }

    .dash-subtitle {
      font-size: 0.85em;
      color: var(--gray);
      margin-top: 4px;
    }

    /* ä¿¡æ¯å¡ç‰‡ç½‘æ ¼ */
    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 28px;
    }

    .info-card {
      background: white;
      border-radius: 16px;
      padding: 24px;
      box-shadow: var(--shadow);
      transition: all 0.3s;
      border: 1px solid var(--border);
    }

    .info-card:hover {
      box-shadow: var(--shadow-lg);
      transform: translateY(-2px);
    }

    .info-header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--border);
    }

    .info-icon {
      width: 50px;
      height: 50px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5em;
      flex-shrink: 0;
    }

    .info-header h4 {
      font-size: 1.1em;
      color: var(--dark);
      margin: 0;
      font-weight: 700;
    }

    .info-header p {
      font-size: 0.85em;
      color: var(--gray);
      margin: 4px 0 0 0;
    }

    .info-stats {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .info-stat {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
    }

    .info-label {
      font-size: 0.9em;
      color: var(--gray);
      font-weight: 500;
    }

    .info-value {
      font-size: 1.1em;
      font-weight: 700;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* å¿«é€Ÿæ“ä½œç½‘æ ¼ */
    .action-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 28px;
    }

    .quick-actions {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-top: 15px;
    }

    .quick-btn {
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      border: 2px solid var(--border);
      padding: 16px;
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      transition: all 0.25s;
      color: var(--dark);
      font-weight: 600;
    }

    .quick-btn:hover {
      border-color: var(--primary);
      background: linear-gradient(135deg, #e0e7ff 0%, #dbeafe 100%);
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }

    .quick-icon {
      font-size: 2em;
    }

    .quick-text {
      font-size: 0.9em;
    }

    /* æŒ‡å—æ­¥éª¤ */
    .guide-steps {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-top: 15px;
    }

    .guide-step {
      display: flex;
      gap: 15px;
      padding: 15px;
      background: #f8fafc;
      border-radius: 10px;
      border-left: 3px solid var(--primary);
      transition: all 0.2s;
    }

    .guide-step:hover {
      background: #f0f4ff;
      transform: translateX(4px);
    }

    .step-num {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 1.1em;
      flex-shrink: 0;
    }

    .step-content {
      flex: 1;
    }

    .step-content strong {
      color: var(--dark);
      display: block;
      margin-bottom: 4px;
      font-size: 1em;
    }

    .step-content p {
      color: var(--gray);
      font-size: 0.9em;
      margin: 0;
      line-height: 1.5;
    }

    /* API ç«¯ç‚¹ç½‘æ ¼ */
    .endpoint-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }

    .endpoint-item {
      padding: 16px;
      background: #f8fafc;
      border-radius: 10px;
      border: 1px solid var(--border);
      transition: all 0.2s;
    }

    .endpoint-item:hover {
      border-color: var(--primary);
      background: #f0f4ff;
      transform: translateY(-2px);
    }

    .endpoint-method {
      display: inline-block;
      padding: 4px 10px;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      border-radius: 6px;
      font-size: 0.75em;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .endpoint-method.post {
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    }

    .endpoint-path {
      font-family: 'Courier New', monospace;
      color: var(--dark);
      font-weight: 600;
      margin-bottom: 6px;
      font-size: 0.95em;
    }

    .endpoint-desc {
      color: var(--gray);
      font-size: 0.85em;
    }

    /* Toast æç¤ºåŠ¨ç”» */
    @keyframes slideInRight {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes slideOutRight {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(400px);
        opacity: 0;
      }
    }

    /* å¤åˆ¶æŒ‰é’®æ ·å¼ */
    .copy-btn {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 0.8em;
      cursor: pointer;
      transition: all 0.2s;
    }

    .copy-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 2px 8px rgba(99, 102, 241, 0.4);
    }

    .copy-btn.copied {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }

    /* Token å¥åº·çŠ¶æ€ */
    .health-badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 0.75em;
      font-weight: 600;
      margin-left: 8px;
    }

    .health-good {
      background: #d1fae5;
      color: #065f46;
    }

    .health-warning {
      background: #fef3c7;
      color: #92400e;
    }

    .health-error {
      background: #fee2e2;
      color: #991b1b;
    }

    /* æ—¥å¿—è¿‡æ»¤å™¨ */
    .log-filters {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      flex-wrap: wrap;
      align-items: center;
    }

    .filter-btn {
      padding: 6px 14px;
      border-radius: 20px;
      border: 2px solid var(--border);
      background: white;
      color: var(--gray);
      cursor: pointer;
      font-size: 0.85em;
      font-weight: 600;
      transition: all 0.2s;
    }

    .filter-btn:hover {
      border-color: var(--primary);
      color: var(--primary);
    }

    .filter-btn.active {
      background: var(--primary);
      border-color: var(--primary);
      color: white;
    }

    .log-search {
      flex: 1;
      min-width: 200px;
      padding: 8px 16px;
      border: 2px solid var(--border);
      border-radius: 20px;
      font-size: 0.9em;
    }

    .log-search:focus {
      outline: none;
      border-color: var(--primary);
    }

    /* è¿›åº¦æ¡ */
    .progress-bar {
      width: 100%;
      height: 8px;
      background: #e2e8f0;
      border-radius: 4px;
      overflow: hidden;
      margin-top: 8px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
      border-radius: 4px;
      transition: width 0.5s ease;
    }

    /* æ‰¹é‡æ“ä½œæ  */
    .batch-actions {
      display: flex;
      gap: 8px;
      padding: 12px;
      background: #f0f4ff;
      border-radius: 8px;
      margin-bottom: 15px;
      align-items: center;
    }

    .batch-actions span {
      font-weight: 600;
      color: var(--primary);
      margin-right: 10px;
    }

    /* æ·±è‰²æ¨¡å¼åˆ‡æ¢ */
    .theme-toggle {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      border: none;
      color: white;
      font-size: 1.5em;
      cursor: pointer;
      box-shadow: var(--shadow-lg);
      transition: all 0.3s;
      z-index: 1000;
    }

    .theme-toggle:hover {
      transform: scale(1.1);
      box-shadow: var(--shadow-xl);
    }

    /* æ·±è‰²æ¨¡å¼æ ·å¼ */
    body.dark-mode {
      --dark: #f8fafc;
      --light: #1e293b;
      --gray: #94a3b8;
      --border: #334155;
      background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #1e293b 100%);
      color: #f8fafc;
    }

    body.dark-mode .card,
    body.dark-mode .status-card,
    body.dark-mode .dash-card,
    body.dark-mode .info-card {
      background: rgba(30, 41, 59, 0.9);
      border-color: #334155;
    }

    body.dark-mode .nav-tabs {
      background: rgba(30, 41, 59, 0.8);
      border-color: #334155;
    }

    body.dark-mode .tab-content {
      background: rgba(30, 41, 59, 0.9);
      border-color: #334155;
    }

    body.dark-mode input,
    body.dark-mode textarea,
    body.dark-mode select {
      background: #1e293b;
      border-color: #334155;
      color: #f8fafc;
    }

    body.dark-mode .token-item,
    body.dark-mode .key-item {
      background: #1e293b;
      border-color: #334155;
    }

    body.dark-mode .key-value {
      background: #0f172a;
      border-color: #334155;
    }

    body.dark-mode .code-block {
      background: #0f172a;
    }

    body.dark-mode .quick-btn {
      background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
      border-color: #334155;
    }

    body.dark-mode .guide-step {
      background: #1e293b;
    }

    body.dark-mode .endpoint-item {
      background: #1e293b;
      border-color: #334155;
    }

    /* ç»Ÿè®¡å›¾è¡¨å®¹å™¨ */
    .chart-container {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: var(--shadow);
    }

    body.dark-mode .chart-container {
      background: #1e293b;
    }

    /* å¿«æ·é”®æç¤º */
    .shortcut-hint {
      display: inline-block;
      padding: 2px 6px;
      background: #f1f5f9;
      border: 1px solid #e2e8f0;
      border-radius: 4px;
      font-size: 0.75em;
      font-family: monospace;
      color: #64748b;
      margin-left: 8px;
    }

    body.dark-mode .shortcut-hint {
      background: #334155;
      border-color: #475569;
      color: #94a3b8;
    }

    /* å“åº”å¼ä¼˜åŒ– */
    @media (max-width: 768px) {
      .container {
        padding: 16px;
      }

      .header {
        padding: 32px 24px;
        border-radius: 16px;
      }

      .header h1 {
        font-size: 1.8em;
      }

      .nav-tabs {
        padding: 8px;
        gap: 6px;
      }

      .nav-tab {
        padding: 10px 14px;
        font-size: 0.85em;
      }

      .tab-content {
        padding: 20px;
        border-radius: 16px;
      }

      .card {
        padding: 20px;
      }

      .status-grid {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 12px;
      }

      .status-card {
        padding: 20px;
      }

      .status-card .value {
        font-size: 1.5em;
      }

      .dashboard-grid {
        grid-template-columns: 1fr;
      }

      .info-grid {
        grid-template-columns: 1fr;
      }

      .action-grid {
        grid-template-columns: 1fr;
      }

      .quick-actions {
        grid-template-columns: 1fr;
      }

      .endpoint-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- ç™»å½•é®ç½©å±‚ -->
  <div id="loginOverlay" class="login-overlay">
    <div class="login-box">
      <h2>ç®¡ç†æ§åˆ¶å°</h2>
      <p>è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç </p>

      <!-- å¯†ç ç™»å½•é€‰é¡¹ -->
      <div class="form-group">
        <label>ç®¡ç†å‘˜å¯†ç </label>
        <input type="password" id="loginPassword" placeholder="è¯·è¾“å…¥å¯†ç " onkeypress="if(event.key==='Enter')doLogin()">
      </div>
      <button onclick="doLogin()" id="loginBtn2">ç™»å½•</button>

      <div id="loginError" class="login-error"></div>
    </div>
  </div>
  <div class="container">
    <div class="header">
      <h1>Antigravity API ç®¡ç†æ§åˆ¶å°</h1>
      <p>Antigravity API è½¬ OpenAI æ ¼å¼çš„ä»£ç†æœåŠ¡</p>
      <div class="header-actions">
        <button onclick="doLogout()" class="logout-btn">é€€å‡ºç™»å½•</button>
      </div>
    </div>

    <div class="nav-tabs">
      <button class="nav-tab active" onclick="switchTab('home')">é¦–é¡µ</button>
      <button class="nav-tab" onclick="switchTab('tokens')">Token ç®¡ç†</button>
      <button class="nav-tab" onclick="switchTab('keys')">å¯†é’¥ç®¡ç†</button>
      <button class="nav-tab" onclick="switchTab('announcements')">å…¬å‘Šç®¡ç†</button>
      <button class="nav-tab" onclick="switchTab('users')">ç”¨æˆ·ç®¡ç†</button>
      <button class="nav-tab" onclick="switchTab('ai')">AI ç®¡ç†</button>
      <button class="nav-tab" onclick="switchTab('test')">API æµ‹è¯•</button>
      <button class="nav-tab" onclick="switchTab('docs')">API æ–‡æ¡£</button>
      <button class="nav-tab" onclick="switchTab('logs')">æ—¥å¿—æŸ¥çœ‹</button>
      <button class="nav-tab" onclick="switchTab('monitor')">ç³»ç»Ÿç›‘æ§</button>
      <button class="nav-tab" onclick="switchTab('settings')">ç³»ç»Ÿè®¾ç½®</button>
    </div>

    <!-- é¦–é¡µ -->
    <div id="home" class="tab-content active">
      <!-- æ ¸å¿ƒæ•°æ®é¢æ¿ -->
      <div class="dashboard-grid">
        <div class="dash-card dash-primary">
          <div class="dash-icon">ğŸš€</div>
          <div class="dash-content">
            <h3>æœåŠ¡çŠ¶æ€</h3>
            <div class="dash-value" id="serviceStatus">è¿è¡Œä¸­</div>
            <div class="dash-subtitle">System Online</div>
          </div>
        </div>

        <div class="dash-card dash-success">
          <div class="dash-icon">ğŸ«</div>
          <div class="dash-content">
            <h3>Token è´¦å·</h3>
            <div class="dash-value" id="tokenCount">0</div>
            <div class="dash-subtitle">å¯ç”¨: <span id="tokenEnabled">0</span> Â· ç¦ç”¨: <span id="tokenDisabled">0</span></div>
          </div>
        </div>

        <div class="dash-card dash-warning">
          <div class="dash-icon">ğŸ”‘</div>
          <div class="dash-content">
            <h3>API å¯†é’¥</h3>
            <div class="dash-value" id="keyCount">0</div>
            <div class="dash-subtitle">æ€»è¯·æ±‚: <span id="keyRequests">0</span></div>
          </div>
        </div>

        <div class="dash-card dash-info">
          <div class="dash-icon">ğŸ“Š</div>
          <div class="dash-content">
            <h3>ä»Šæ—¥è¯·æ±‚</h3>
            <div class="dash-value" id="todayRequests">0</div>
            <div class="dash-subtitle">API Calls Today</div>
          </div>
        </div>
      </div>

      <!-- ç³»ç»Ÿä¿¡æ¯æ¦‚è§ˆ -->
      <div class="info-grid">
        <div class="info-card">
          <div class="info-header">
            <div class="info-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">ğŸ’»</div>
            <div>
              <h4>ç³»ç»Ÿæ€§èƒ½</h4>
              <p>å®æ—¶ç›‘æ§æ•°æ®</p>
            </div>
          </div>
          <div class="info-stats">
            <div class="info-stat">
              <span class="info-label">CPU ä½¿ç”¨ç‡</span>
              <span class="info-value" id="homeCpu">-</span>
            </div>
            <div class="info-stat">
              <span class="info-label">å†…å­˜ä½¿ç”¨</span>
              <span class="info-value" id="homeMemory">-</span>
            </div>
            <div class="info-stat">
              <span class="info-label">è¿è¡Œæ—¶é•¿</span>
              <span class="info-value" id="homeUptime">-</span>
            </div>
          </div>
        </div>

        <div class="info-card">
          <div class="info-header">
            <div class="info-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">ğŸ“ˆ</div>
            <div>
              <h4>Token è½®è¯¢</h4>
              <p>è´Ÿè½½å‡è¡¡çŠ¶æ€</p>
            </div>
          </div>
          <div class="info-stats">
            <div class="info-stat">
              <span class="info-label">æ€» Token æ•°</span>
              <span class="info-value" id="homeTotalTokens">0</span>
            </div>
            <div class="info-stat">
              <span class="info-label">å½“å‰ä½ç½®</span>
              <span class="info-value" id="homeCurrentIndex">#0</span>
            </div>
            <div class="info-stat">
              <span class="info-label">è½®è¯¢è¯·æ±‚</span>
              <span class="info-value" id="homeRotationRequests">0</span>
            </div>
          </div>
        </div>

        <div class="info-card">
          <div class="info-header">
            <div class="info-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">âš¡</div>
            <div>
              <h4>æœåŠ¡å™¨çŠ¶æ€</h4>
              <p>ç©ºé—²æ¨¡å¼ç®¡ç†</p>
            </div>
          </div>
          <div class="info-stats">
            <div class="info-stat">
              <span class="info-label">å½“å‰çŠ¶æ€</span>
              <span class="info-value" id="homeIdleStatus">æ´»è·ƒ</span>
            </div>
            <div class="info-stat">
              <span class="info-label">ç©ºé—²æ—¶é—´</span>
              <span class="info-value" id="homeIdleTime">0 ç§’</span>
            </div>
            <div class="info-stat">
              <span class="info-label">æ€»è¯·æ±‚æ•°</span>
              <span class="info-value" id="homeTotalRequests">0</span>
            </div>
          </div>
        </div>
      </div>

      <!-- å¿«é€Ÿæ“ä½œå’Œæœ€è¿‘æ´»åŠ¨ -->
      <div class="action-grid">
        <div class="card">
          <h3>âš¡ å¿«é€Ÿæ“ä½œ</h3>
          <div class="quick-actions">
            <button onclick="switchTab('tokens')" class="quick-btn">
              <span class="quick-icon">ğŸ«</span>
              <span class="quick-text">ç®¡ç† Token</span>
            </button>
            <button onclick="switchTab('keys')" class="quick-btn">
              <span class="quick-icon">ğŸ”‘</span>
              <span class="quick-text">ç”Ÿæˆå¯†é’¥</span>
            </button>
            <button onclick="switchTab('test')" class="quick-btn">
              <span class="quick-icon">ğŸ§ª</span>
              <span class="quick-text">æµ‹è¯• API</span>
            </button>
            <button onclick="switchTab('monitor')" class="quick-btn">
              <span class="quick-icon">ğŸ“Š</span>
              <span class="quick-text">ç³»ç»Ÿç›‘æ§</span>
            </button>
          </div>
        </div>

        <div class="card">
          <h3>ğŸ“ å¿«é€Ÿå¼€å§‹æŒ‡å—</h3>
          <div class="guide-steps">
            <div class="guide-step">
              <div class="step-num">1</div>
              <div class="step-content">
                <strong>è·å– Token</strong>
                <p>åœ¨ Token ç®¡ç†é¡µé¢é€šè¿‡ Google OAuth ç™»å½•è·å–è®¿é—®ä»¤ç‰Œ</p>
              </div>
            </div>
            <div class="guide-step">
              <div class="step-num">2</div>
              <div class="step-content">
                <strong>ç”Ÿæˆå¯†é’¥</strong>
                <p>åœ¨å¯†é’¥ç®¡ç†é¡µé¢åˆ›å»º API å¯†é’¥ç”¨äºåº”ç”¨ç¨‹åºè®¿é—®</p>
              </div>
            </div>
            <div class="guide-step">
              <div class="step-num">3</div>
              <div class="step-content">
                <strong>æµ‹è¯•æ¥å£</strong>
                <p>ä½¿ç”¨ API æµ‹è¯•å·¥å…·éªŒè¯æœåŠ¡æ˜¯å¦æ­£å¸¸å·¥ä½œ</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- API ç«¯ç‚¹ä¿¡æ¯ -->
      <div class="card">
        <h3>ğŸŒ API ç«¯ç‚¹ä¿¡æ¯</h3>
        <div class="endpoint-grid">
          <div class="endpoint-item">
            <div class="endpoint-method">GET</div>
            <div class="endpoint-path">/v1/models</div>
            <div class="endpoint-desc">è·å–æ¨¡å‹åˆ—è¡¨</div>
          </div>
          <div class="endpoint-item">
            <div class="endpoint-method post">POST</div>
            <div class="endpoint-path">/v1/chat/completions</div>
            <div class="endpoint-desc">èŠå¤©è¡¥å…¨æ¥å£</div>
          </div>
          <div class="endpoint-item">
            <div class="endpoint-method">GET</div>
            <div class="endpoint-path">/admin/status</div>
            <div class="endpoint-desc">ç³»ç»ŸçŠ¶æ€ç›‘æ§</div>
          </div>
        </div>
        <div style="margin-top: 15px; padding: 12px; background: #f0f4ff; border-radius: 8px; border-left: 3px solid #667eea;">
          <strong style="color: #667eea;">åŸºç¡€ URL:</strong>
          <code id="homeBaseUrl" style="margin-left: 10px;">-</code>
        </div>
      </div>
    </div>

    <!-- Token ç®¡ç† -->
    <div id="tokens" class="tab-content">
      <div class="card">
        <h3>Google OAuth ç™»å½•</h3>
        <p style="color: #5a6c7d; margin-bottom: 15px;">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¯åŠ¨ Google OAuth ç™»å½•æµç¨‹ï¼Œè·å–è®¿é—® Tokenã€‚</p>
        <button onclick="triggerGoogleLogin()" id="loginBtn" class="btn-success">ç™»å½•è·å– Token</button>
        <div id="loginResult" style="margin-top: 15px;"></div>
      </div>

      <div class="card">
        <h3>æ‰‹åŠ¨æ·»åŠ  Tokenï¼ˆå›è°ƒé“¾æ¥ï¼‰</h3>
        <p style="color: #5a6c7d; margin-bottom: 15px;">å¦‚æœè‡ªåŠ¨å›è°ƒå¤±è´¥ï¼Œå¯ä»¥å°†æµè§ˆå™¨åœ°å€æ ä¸­çš„å®Œæ•´å›è°ƒé“¾æ¥ç²˜è´´åˆ°ä¸‹æ–¹ã€‚</p>
        <div class="form-group">
          <label>å›è°ƒé“¾æ¥</label>
          <input type="text" id="callbackUrl" placeholder="http://localhost:xxxx/oauth-callback?code=...">
        </div>
        <button onclick="addTokenManually()" id="addTokenBtn" class="btn-success">æ·»åŠ  Token</button>
        <div id="addTokenResult" style="margin-top: 15px;"></div>
      </div>

      <div class="card">
        <h3>æ‰‹åŠ¨æ·»åŠ  Tokenï¼ˆç›´æ¥è¾“å…¥ï¼‰</h3>
        <p style="color: #5a6c7d; margin-bottom: 15px;">ç›´æ¥ç²˜è´´æ‚¨çš„ Google OAuth Token ä¿¡æ¯ã€‚å¦‚æœæ‚¨å·²ç»é€šè¿‡å…¶ä»–æ–¹å¼è·å–äº† Tokenï¼Œå¯ä»¥åœ¨æ­¤å¤„æ‰‹åŠ¨æ·»åŠ ã€‚</p>

        <div class="form-group">
          <label>Access Token <span style="color: #e74c3c;">*</span></label>
          <textarea id="directAccessToken" placeholder="ç²˜è´´ access_token..." rows="3"></textarea>
          <small style="color: #7f8c8d; font-size: 0.85em; display: block; margin-top: 5px;">
            å¿…å¡«é¡¹ï¼šè®¿é—®ä»¤ç‰Œ
          </small>
        </div>

        <div class="form-group">
          <label>Refresh Token</label>
          <textarea id="directRefreshToken" placeholder="ç²˜è´´ refresh_tokenï¼ˆå¯é€‰ï¼‰..." rows="2"></textarea>
          <small style="color: #7f8c8d; font-size: 0.85em; display: block; margin-top: 5px;">
            å¯é€‰é¡¹ï¼šåˆ·æ–°ä»¤ç‰Œï¼ˆç”¨äºè‡ªåŠ¨ç»­æœŸï¼‰
          </small>
        </div>

        <div class="form-group">
          <label>è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰</label>
          <input type="number" id="directExpiresIn" placeholder="ä¾‹å¦‚: 3600" value="3600">
          <small style="color: #7f8c8d; font-size: 0.85em; display: block; margin-top: 5px;">
            Token æœ‰æ•ˆæœŸï¼Œé»˜è®¤ 3600 ç§’ï¼ˆ1å°æ—¶ï¼‰
          </small>
        </div>

        <button onclick="addDirectToken()" id="addDirectTokenBtn" class="btn-success">æ·»åŠ  Token</button>
        <div id="addDirectTokenResult" style="margin-top: 15px;"></div>
      </div>

      <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
          <h3 style="margin: 0;">å·²æœ‰ Token è´¦å·</h3>
          <div class="flex-buttons">
            <button onclick="selectAllTokens()" class="btn-secondary">å…¨é€‰</button>
            <button onclick="exportSelectedTokens()" class="btn-warning">å¯¼å‡ºé€‰ä¸­</button>
            <button onclick="importTokens()" class="btn-success">å¯¼å…¥å‹ç¼©åŒ…</button>
            <button onclick="loadTokens()" class="btn-secondary">åˆ·æ–°åˆ—è¡¨</button>
          </div>
        </div>
        <div id="tokenList">
          <div style="text-align: center; color: #999; padding: 20px;">åŠ è½½ä¸­...</div>
        </div>
      </div>
    </div>

    <!-- å¯†é’¥ç®¡ç† -->
    <div id="keys" class="tab-content">
      <div class="card">
        <h3>ç”Ÿæˆæ–°å¯†é’¥</h3>
        <div class="form-group">
          <label>å¯†é’¥åç§°ï¼ˆå¯é€‰ï¼‰</label>
          <input type="text" id="keyName" placeholder="ä¾‹å¦‚: æˆ‘çš„åº”ç”¨å¯†é’¥">
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" id="enableRateLimit" onchange="toggleRateLimitFields()" style="width: auto; margin-right: 8px;">
            å¯ç”¨é¢‘ç‡é™åˆ¶
          </label>
        </div>
        <div id="rateLimitFields" style="display: none;">
          <div class="form-group">
            <label>æœ€å¤§è¯·æ±‚æ•°</label>
            <input type="number" id="maxRequests" value="100" min="1" placeholder="ä¾‹å¦‚: 100">
          </div>
          <div class="form-group">
            <label>æ—¶é—´çª—å£ï¼ˆç§’ï¼‰</label>
            <input type="number" id="windowSeconds" value="60" min="1" placeholder="ä¾‹å¦‚: 60">
            <small style="color: #7f8c8d; display: block; margin-top: 5px;">è®¾ç½®æ—¶é—´çª—å£å†…å…è®¸çš„æœ€å¤§è¯·æ±‚æ•°ã€‚ä¾‹å¦‚ï¼š100 æ¬¡/60 ç§’</small>
          </div>
        </div>
        <button onclick="generateKey()">ç”Ÿæˆå¯†é’¥</button>
      </div>

      <div class="card">
        <h3>å·²æœ‰å¯†é’¥</h3>
        <ul class="key-list" id="keyList">
          <li style="text-align: center; color: #999;">æš‚æ— å¯†é’¥</li>
        </ul>
      </div>
    </div>

    <!-- å…¬å‘Šç®¡ç† -->
    <div id="announcements" class="tab-content">
      <div class="card">
        <h3>åˆ›å»ºæ–°å…¬å‘Š</h3>
        <div class="form-group">
          <label>å…¬å‘Šæ ‡é¢˜ <span style="color: var(--danger);">*</span></label>
          <input type="text" id="announcementTitle" placeholder="è¯·è¾“å…¥å…¬å‘Šæ ‡é¢˜">
        </div>
        <div class="form-group">
          <label>å…¬å‘Šå†…å®¹ <span style="color: var(--danger);">*</span></label>
          <textarea id="announcementContent" rows="6" placeholder="è¯·è¾“å…¥å…¬å‘Šå†…å®¹ï¼Œæ”¯æŒæ¢è¡Œ"></textarea>
        </div>
        <div class="form-group">
          <label>å…¬å‘Šç±»å‹</label>
          <select id="announcementType">
            <option value="info">ä¿¡æ¯ (è“è‰²)</option>
            <option value="success">æˆåŠŸ (ç»¿è‰²)</option>
            <option value="warning">è­¦å‘Š (é»„è‰²)</option>
            <option value="danger">å±é™© (çº¢è‰²)</option>
          </select>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" id="announcementPinned" style="width: auto; margin-right: 8px;">
            ç½®é¡¶å…¬å‘Š
          </label>
        </div>
        <div class="form-group">
          <label>ä¸Šä¼ å›¾ç‰‡ï¼ˆå¯é€‰ï¼Œæœ€å¤š5å¼ ï¼‰</label>
          <input type="file" id="announcementImages" multiple accept="image/*" style="padding: 10px;">
          <small style="color: var(--gray); display: block; margin-top: 8px;">æ”¯æŒ JPG, PNG, GIF, WEBP ç­‰æ ¼å¼ï¼Œæ¯å¼ å›¾ç‰‡æœ€å¤§ 10MB</small>
          <div id="imagePreview" style="display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap;"></div>
        </div>
        <button onclick="createAnnouncement()">å‘å¸ƒå…¬å‘Š</button>
        <div id="createAnnouncementResult" style="margin-top: 15px;"></div>
      </div>

      <div class="card">
        <h3>æ‰€æœ‰å…¬å‘Š</h3>
        <div id="announcementList">
          <div style="text-align: center; color: #999; padding: 20px;">æš‚æ— å…¬å‘Š</div>
        </div>
      </div>
    </div>

    <!-- ç”¨æˆ·ç®¡ç† -->
    <div id="users" class="tab-content">
      <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); margin-bottom: 24px;">
        <div class="stat-card">
          <h4>æ€»ç”¨æˆ·æ•°</h4>
          <div class="stat-value" id="totalUsers">0</div>
        </div>
        <div class="stat-card">
          <h4>æ´»è·ƒç”¨æˆ·</h4>
          <div class="stat-value" id="activeUsers">0</div>
        </div>
        <div class="stat-card">
          <h4>å…±äº«Tokenæ•°</h4>
          <div class="stat-value" id="sharedTokensCount">0</div>
        </div>
        <div class="stat-card">
          <h4>ä»Šæ—¥è°ƒç”¨</h4>
          <div class="stat-value" id="todayCalls">0</div>
        </div>
      </div>

      <div class="card">
        <h3>ç”¨æˆ·åˆ—è¡¨</h3>
        <div id="userList">
          <div style="text-align: center; color: #999; padding: 20px;">åŠ è½½ä¸­...</div>
        </div>
      </div>
    </div>

    <!-- AI ç®¡ç† -->
    <div id="ai" class="tab-content">
      <!-- AI ç»Ÿè®¡ -->
      <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); margin-bottom: 24px;">
        <div class="stat-card">
          <h4>æ€»å®¡æ ¸æ¬¡æ•°</h4>
          <div class="stat-value" id="aiTotalRuns">0</div>
        </div>
        <div class="stat-card">
          <h4>æ€»å°ç¦æ•°</h4>
          <div class="stat-value" id="aiTotalBanned">0</div>
        </div>
        <div class="stat-card">
          <h4>æ€»æ ‡è®°æ•°</h4>
          <div class="stat-value" id="aiTotalFlagged">0</div>
        </div>
        <div class="stat-card">
          <h4>å¹³å‡è€—æ—¶</h4>
          <div class="stat-value" id="aiAvgDuration">0</div>
        </div>
      </div>

      <!-- AI é…ç½® -->
      <div class="card" style="margin-bottom: 24px;">
        <h3>ğŸ¤– AI è‡ªåŠ¨å®¡æ ¸é…ç½®</h3>
        <div style="display: grid; gap: 16px; margin-top: 20px;">
          <div style="display: grid; grid-template-columns: 200px 1fr; gap: 12px; align-items: center;">
            <label style="font-weight: 500;">å¯ç”¨AIå®¡æ ¸:</label>
            <label style="cursor: pointer; display: inline-flex; align-items: center; gap: 8px;">
              <input type="checkbox" id="aiEnabled" style="width: 18px; height: 18px; cursor: pointer;">
              <span style="color: var(--gray); font-size: 0.9em;">æ¯éš”æŒ‡å®šæ—¶é—´è‡ªåŠ¨åˆ†æå…±äº«ç”¨æˆ·æ•°æ®</span>
            </label>
          </div>

          <div style="display: grid; grid-template-columns: 200px 1fr; gap: 12px; align-items: center;">
            <label style="font-weight: 500;">API ç«¯ç‚¹:</label>
            <input type="text" id="aiApiEndpoint" placeholder="ä¾‹å¦‚: http://localhost:8045/v1/chat/completions" style="padding: 10px; border: 1px solid var(--border); border-radius: 8px; font-family: monospace;">
          </div>

          <div style="display: grid; grid-template-columns: 200px 1fr; gap: 12px; align-items: center;">
            <label style="font-weight: 500;">API å¯†é’¥:</label>
            <input type="password" id="aiApiKey" placeholder="sk-..." style="padding: 10px; border: 1px solid var(--border); border-radius: 8px; font-family: monospace;">
          </div>

          <div style="display: grid; grid-template-columns: 200px 1fr; gap: 12px; align-items: center;">
            <label style="font-weight: 500;">æ¨¡å‹:</label>
            <input type="text" id="aiModel" placeholder="gemini-2.0-flash-exp" style="padding: 10px; border: 1px solid var(--border); border-radius: 8px;">
          </div>

          <div style="display: grid; grid-template-columns: 200px 1fr; gap: 12px; align-items: center;">
            <label style="font-weight: 500;">æ£€æŸ¥é—´éš”(å°æ—¶):</label>
            <input type="number" id="aiCheckInterval" min="1" max="24" value="1" style="padding: 10px; border: 1px solid var(--border); border-radius: 8px; width: 120px;">
          </div>

          <div style="display: grid; grid-template-columns: 200px 1fr; gap: 12px; align-items: center;">
            <label style="font-weight: 500;">ç½®ä¿¡åº¦é˜ˆå€¼:</label>
            <div style="display: flex; align-items: center; gap: 12px;">
              <input type="range" id="aiThreshold" min="0" max="1" step="0.05" value="0.8" style="flex: 1;">
              <span id="aiThresholdValue" style="font-family: monospace; font-weight: bold; min-width: 40px;">0.8</span>
            </div>
          </div>

          <div style="display: grid; grid-template-columns: 200px 1fr; gap: 12px; align-items: start;">
            <label style="font-weight: 500; padding-top: 10px;">ç³»ç»Ÿæç¤ºè¯:</label>
            <textarea id="aiSystemPrompt" rows="8" style="padding: 10px; border: 1px solid var(--border); border-radius: 8px; font-family: monospace; font-size: 0.85em; resize: vertical;" placeholder="AIç³»ç»Ÿæç¤ºè¯..."></textarea>
          </div>

          <div style="display: flex; gap: 12px; margin-top: 12px;">
            <button onclick="saveAIConfig()" style="background: var(--primary); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 500;">ğŸ’¾ ä¿å­˜é…ç½®</button>
            <button onclick="runAIModeration()" style="background: var(--success); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 500;">â–¶ï¸ ç«‹å³è¿è¡Œå®¡æ ¸</button>
            <button onclick="loadAIConfig()" style="background: var(--gray); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 500;">ğŸ”„ åˆ·æ–°é…ç½®</button>
          </div>
        </div>
      </div>

      <!-- AI æœ€æ–°å®¡æ ¸è®°å½• -->
      <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
          <h3>ğŸ“‹ æœ€æ–°å®¡æ ¸è®°å½•</h3>
          <button onclick="loadAILogs()" style="background: var(--info); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">åˆ·æ–°æ—¥å¿—</button>
        </div>
        <div id="aiLogsList" style="max-height: 500px; overflow-y: auto;">
          <div style="text-align: center; color: #999; padding: 20px;">åŠ è½½ä¸­...</div>
        </div>
      </div>
    </div>

    <!-- API æµ‹è¯• -->
    <div id="test" class="tab-content">
      <!-- æç¤ºä¿¡æ¯ -->
      <div style="background: linear-gradient(135deg, #eff6ff 0%, #e0f2fe 100%); padding: 16px 20px; border-radius: 12px; border-left: 4px solid #3b82f6; margin-bottom: 20px;">
        <div style="display: flex; align-items: start; gap: 12px;">
          <span style="font-size: 1.5em;">ğŸ’¡</span>
          <div>
            <strong style="color: #1e40af; display: block; margin-bottom: 4px;">ä½¿ç”¨æç¤º</strong>
            <p style="color: #1e40af; margin: 0; font-size: 0.9em; line-height: 1.5;">
              å¦‚æœæ¨¡å‹åˆ—è¡¨åŠ è½½å¤±è´¥ï¼Œè¯·å…ˆåœ¨ <strong onclick="switchTab('tokens')" style="cursor: pointer; text-decoration: underline;">Token ç®¡ç†</strong> é¡µé¢æ·»åŠ  Google Tokenã€‚
              ç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨å¯ç”¨çš„ Token æ¥è·å–æ¨¡å‹åˆ—è¡¨ã€‚
            </p>
          </div>
        </div>
      </div>

      <div class="card">
        <h3>èŠå¤©æµ‹è¯•</h3>
        <div id="chatMessages"></div>
        <div class="form-group">
          <label>æ¶ˆæ¯å†…å®¹</label>
          <textarea id="testMessage" placeholder="è¾“å…¥ä½ çš„æ¶ˆæ¯...">ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹è‡ªå·±</textarea>
        </div>
        <div class="form-group">
          <label>é€‰æ‹©æ¨¡å‹ <button onclick="loadModels()" class="btn-secondary" style="padding: 4px 12px; font-size: 0.85em; margin-left: 10px;">åˆ·æ–°æ¨¡å‹åˆ—è¡¨</button></label>
          <select id="testModel">
            <option value="">åŠ è½½ä¸­...</option>
          </select>
        </div>
        <div class="form-group">
          <label>API å¯†é’¥</label>
          <input type="text" id="testApiKey" placeholder="è¾“å…¥ä½ çš„ API å¯†é’¥">
        </div>
        <div class="flex-buttons">
          <button onclick="sendTestMessage()" id="sendBtn">å‘é€æ¶ˆæ¯</button>
          <button onclick="clearChat()" class="btn-secondary">æ¸…ç©ºå¯¹è¯</button>
        </div>
      </div>
    </div>

    <!-- API æ–‡æ¡£ -->
    <div id="docs" class="tab-content">
      <div class="card">
        <h3>ğŸŒ API ç«¯ç‚¹æ¦‚è§ˆ</h3>
        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 3px solid #667eea; margin-bottom: 15px;">
          <div style="color: #7f8c8d; font-size: 0.9em; margin-bottom: 8px;">åŸºç¡€ URL</div>
          <code id="baseUrl" style="display: block; background: white; padding: 12px; border-radius: 6px; color: #2c3e50; font-size: 1em; border: 1px solid #e9ecef;">http://localhost:8045</code>
        </div>
        <p style="color: #5a6c7d;">æœ¬æœåŠ¡æä¾›ä¸ OpenAI API å…¼å®¹çš„æ¥å£ï¼Œå¯æ— ç¼å¯¹æ¥ä»»ä½•æ”¯æŒ OpenAI æ ¼å¼çš„åº”ç”¨ç¨‹åºã€‚</p>
      </div>

      <div class="api-endpoint">
        <h4>ğŸ“‹ GET /v1/models</h4>
        <p><strong>åŠŸèƒ½ï¼š</strong>è·å–æ‰€æœ‰å¯ç”¨çš„AIæ¨¡å‹åˆ—è¡¨</p>
        <p><strong>è®¤è¯ï¼š</strong>éœ€è¦ Bearer Token</p>

        <div style="margin: 15px 0;">
          <strong>è¯·æ±‚ç¤ºä¾‹ï¼š</strong>
          <div class="code-block">curl http://localhost:8045/v1/models \
  -H "Authorization: Bearer YOUR_API_KEY"</div>
        </div>

        <div style="margin: 15px 0;">
          <strong>å“åº”ç¤ºä¾‹ï¼š</strong>
          <div class="code-block">{
  "object": "list",
  "data": [
    {
      "id": "gemini-2.0-flash-exp",
      "object": "model",
      "created": 1234567890,
      "owned_by": "google"
    },
    {
      "id": "gemini-exp-1206",
      "object": "model",
      "created": 1234567890,
      "owned_by": "google"
    }
  ]
}</div>
        </div>
      </div>

      <div class="api-endpoint">
        <h4>ğŸ’¬ POST /v1/chat/completions</h4>
        <p><strong>åŠŸèƒ½ï¼š</strong>åˆ›å»ºèŠå¤©å¯¹è¯è¡¥å…¨ï¼Œæ”¯æŒæµå¼å’Œéæµå¼å“åº”</p>
        <p><strong>è®¤è¯ï¼š</strong>éœ€è¦ Bearer Token</p>
        <p><strong>å†…å®¹ç±»å‹ï¼š</strong>application/json</p>

        <div style="margin: 15px 0;">
          <strong>æµå¼è¯·æ±‚ç¤ºä¾‹ï¼ˆæ¨èï¼‰ï¼š</strong>
          <div class="code-block">curl http://localhost:8045/v1/chat/completions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "model": "gemini-2.0-flash-exp",
    "messages": [
      {"role": "system", "content": "ä½ æ˜¯ä¸€ä¸ªæœ‰å¸®åŠ©çš„AIåŠ©æ‰‹"},
      {"role": "user", "content": "ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±"}
    ],
    "stream": true,
    "temperature": 1.0,
    "max_tokens": 8096
  }'</div>
        </div>

        <div style="margin: 15px 0;">
          <strong>éæµå¼è¯·æ±‚ç¤ºä¾‹ï¼š</strong>
          <div class="code-block">curl http://localhost:8045/v1/chat/completions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "model": "gemini-exp-1206",
    "messages": [
      {"role": "user", "content": "ä»€ä¹ˆæ˜¯äººå·¥æ™ºèƒ½ï¼Ÿ"}
    ],
    "stream": false
  }'</div>
        </div>

        <div style="margin: 15px 0;">
          <strong>æµå¼å“åº”æ ¼å¼ï¼š</strong>
          <div class="code-block">data: {"id":"chatcmpl-xxx","object":"chat.completion.chunk","created":xxx,"model":"gemini-2.0-flash-exp","choices":[{"index":0,"delta":{"content":"ä½ å¥½"},"finish_reason":null}]}

data: {"id":"chatcmpl-xxx","object":"chat.completion.chunk","created":xxx,"model":"gemini-2.0-flash-exp","choices":[{"index":0,"delta":{"content":"ï¼"},"finish_reason":null}]}

data: {"id":"chatcmpl-xxx","object":"chat.completion.chunk","created":xxx,"model":"gemini-2.0-flash-exp","choices":[{"index":0,"delta":{},"finish_reason":"stop"}]}

data: [DONE]</div>
        </div>

        <div style="margin: 15px 0;">
          <strong>éæµå¼å“åº”æ ¼å¼ï¼š</strong>
          <div class="code-block">{
  "id": "chatcmpl-1234567890",
  "object": "chat.completion",
  "created": 1234567890,
  "model": "gemini-2.0-flash-exp",
  "choices": [
    {
      "index": 0,
      "message": {
        "role": "assistant",
        "content": "ä½ å¥½ï¼æˆ‘æ˜¯ä¸€ä¸ªAIåŠ©æ‰‹..."
      },
      "finish_reason": "stop"
    }
  ]
}</div>
        </div>
      </div>

      <div class="card">
        <h3>ğŸ“ è¯·æ±‚å‚æ•°è¯¦è§£</h3>
        <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
          <thead>
            <tr style="background: #f8f9fa; border-bottom: 2px solid #667eea;">
              <th style="padding: 12px; text-align: left; color: #2c3e50;">å‚æ•°å</th>
              <th style="padding: 12px; text-align: left; color: #2c3e50;">ç±»å‹</th>
              <th style="padding: 12px; text-align: left; color: #2c3e50;">å¿…éœ€</th>
              <th style="padding: 12px; text-align: left; color: #2c3e50;">è¯´æ˜</th>
            </tr>
          </thead>
          <tbody style="color: #5a6c7d;">
            <tr style="border-bottom: 1px solid #e9ecef;">
              <td style="padding: 12px;"><code style="background: #f8f9fa; padding: 3px 8px; border-radius: 4px; color: #667eea;">model</code></td>
              <td style="padding: 12px;">string</td>
              <td style="padding: 12px;"><span style="color: #e74c3c; font-weight: 600;">âœ“ æ˜¯</span></td>
              <td style="padding: 12px;">è¦ä½¿ç”¨çš„æ¨¡å‹IDï¼Œå¦‚ "gemini-2.0-flash-exp"</td>
            </tr>
            <tr style="border-bottom: 1px solid #e9ecef;">
              <td style="padding: 12px;"><code style="background: #f8f9fa; padding: 3px 8px; border-radius: 4px; color: #667eea;">messages</code></td>
              <td style="padding: 12px;">array</td>
              <td style="padding: 12px;"><span style="color: #e74c3c; font-weight: 600;">âœ“ æ˜¯</span></td>
              <td style="padding: 12px;">å¯¹è¯æ¶ˆæ¯æ•°ç»„ï¼Œæ¯æ¡æ¶ˆæ¯åŒ…å« roleï¼ˆsystem/user/assistantï¼‰å’Œ content</td>
            </tr>
            <tr style="border-bottom: 1px solid #e9ecef;">
              <td style="padding: 12px;"><code style="background: #f8f9fa; padding: 3px 8px; border-radius: 4px; color: #667eea;">stream</code></td>
              <td style="padding: 12px;">boolean</td>
              <td style="padding: 12px;"><span style="color: #95a5a6;">å¦</span></td>
              <td style="padding: 12px;">æ˜¯å¦ä½¿ç”¨æµå¼è¾“å‡ºï¼Œé»˜è®¤ trueã€‚æµå¼è¾“å‡ºå¯å®æ—¶æ˜¾ç¤ºç”Ÿæˆå†…å®¹</td>
            </tr>
            <tr style="border-bottom: 1px solid #e9ecef;">
              <td style="padding: 12px;"><code style="background: #f8f9fa; padding: 3px 8px; border-radius: 4px; color: #667eea;">temperature</code></td>
              <td style="padding: 12px;">number</td>
              <td style="padding: 12px;"><span style="color: #95a5a6;">å¦</span></td>
              <td style="padding: 12px;">é‡‡æ ·æ¸©åº¦ï¼ŒèŒƒå›´ 0-2ï¼Œé»˜è®¤ 1.0ã€‚è¶Šé«˜è¶Šéšæœºï¼Œè¶Šä½è¶Šç¡®å®š</td>
            </tr>
            <tr style="border-bottom: 1px solid #e9ecef;">
              <td style="padding: 12px;"><code style="background: #f8f9fa; padding: 3px 8px; border-radius: 4px; color: #667eea;">max_tokens</code></td>
              <td style="padding: 12px;">integer</td>
              <td style="padding: 12px;"><span style="color: #95a5a6;">å¦</span></td>
              <td style="padding: 12px;">ç”Ÿæˆçš„æœ€å¤§tokenæ•°é‡ï¼Œé»˜è®¤ 8096</td>
            </tr>
            <tr style="border-bottom: 1px solid #e9ecef;">
              <td style="padding: 12px;"><code style="background: #f8f9fa; padding: 3px 8px; border-radius: 4px; color: #667eea;">top_p</code></td>
              <td style="padding: 12px;">number</td>
              <td style="padding: 12px;"><span style="color: #95a5a6;">å¦</span></td>
              <td style="padding: 12px;">æ ¸é‡‡æ ·å‚æ•°ï¼ŒèŒƒå›´ 0-1ï¼Œé»˜è®¤ 0.85ã€‚ä¸ temperature äºŒé€‰ä¸€ä½¿ç”¨</td>
            </tr>
            <tr>
              <td style="padding: 12px;"><code style="background: #f8f9fa; padding: 3px 8px; border-radius: 4px; color: #667eea;">top_k</code></td>
              <td style="padding: 12px;">integer</td>
              <td style="padding: 12px;"><span style="color: #95a5a6;">å¦</span></td>
              <td style="padding: 12px;">Top-Ké‡‡æ ·å‚æ•°ï¼Œé»˜è®¤ 50ã€‚é™åˆ¶æ¯æ­¥åªè€ƒè™‘æ¦‚ç‡æœ€é«˜çš„Kä¸ªtoken</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="card">
        <h3>ğŸ” è®¤è¯æ–¹å¼</h3>
        <p style="color: #5a6c7d; margin-bottom: 15px;">æ‰€æœ‰APIè¯·æ±‚éƒ½éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­åŒ…å«æœ‰æ•ˆçš„APIå¯†é’¥ï¼š</p>
        <div class="code-block">Authorization: Bearer YOUR_API_KEY</div>
        <div style="background: #fff9e6; padding: 15px; border-radius: 8px; border-left: 3px solid #f39c12; margin-top: 15px;">
          <strong style="color: #f39c12;">âš ï¸ æ³¨æ„ï¼š</strong>
          <ul style="margin: 10px 0 0 20px; color: #5a6c7d;">
            <li>è¯·å¦¥å–„ä¿ç®¡æ‚¨çš„APIå¯†é’¥ï¼Œä¸è¦åœ¨å…¬å¼€åœºåˆæ³„éœ²</li>
            <li>å¯åœ¨"å¯†é’¥ç®¡ç†"é¡µé¢ç”Ÿæˆå’Œç®¡ç†APIå¯†é’¥</li>
            <li>æ”¯æŒä¸ºä¸åŒå¯†é’¥è®¾ç½®ç‹¬ç«‹çš„é¢‘ç‡é™åˆ¶</li>
          </ul>
        </div>
      </div>

      <div class="card">
        <h3>âš¡ é¢‘ç‡é™åˆ¶</h3>
        <p style="color: #5a6c7d; margin-bottom: 15px;">å½“è¯·æ±‚è¶…è¿‡é¢‘ç‡é™åˆ¶æ—¶ï¼ŒAPIä¼šè¿”å›429çŠ¶æ€ç ï¼š</p>
        <div class="code-block">{
  "error": {
    "message": "è¯·æ±‚é¢‘ç‡è¶…é™",
    "type": "rate_limit_exceeded"
  }
}</div>
        <p style="color: #5a6c7d; margin-top: 15px;">å“åº”å¤´ä¼šåŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š</p>
        <ul style="color: #5a6c7d; margin-left: 20px;">
          <li><code>X-RateLimit-Limit</code>: æ—¶é—´çª—å£å†…å…è®¸çš„æœ€å¤§è¯·æ±‚æ•°</li>
          <li><code>X-RateLimit-Remaining</code>: å‰©ä½™å¯ç”¨è¯·æ±‚æ•°</li>
          <li><code>X-RateLimit-Reset</code>: é™åˆ¶é‡ç½®å‰çš„ç­‰å¾…ç§’æ•°</li>
        </ul>
      </div>

      <div class="card">
        <h3>ğŸ’¡ ä½¿ç”¨å»ºè®®</h3>
        <ul style="color: #5a6c7d; line-height: 2; margin-left: 20px;">
          <li><strong>ä½¿ç”¨æµå¼è¾“å‡ºï¼š</strong>å¯¹äºé•¿å¯¹è¯ï¼Œå»ºè®®ä½¿ç”¨ stream: true ä»¥è·å¾—æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ</li>
          <li><strong>æ¸©åº¦å‚æ•°è°ƒèŠ‚ï¼š</strong>åˆ›æ„å†™ä½œå¯ä½¿ç”¨è¾ƒé«˜æ¸©åº¦(1.2-1.5)ï¼Œäº‹å®æ€§å›ç­”ä½¿ç”¨è¾ƒä½æ¸©åº¦(0.3-0.7)</li>
          <li><strong>åˆç†è®¾ç½®max_tokensï¼š</strong>æ ¹æ®å®é™…éœ€æ±‚è®¾ç½®ï¼Œé¿å…ä¸å¿…è¦çš„tokenæ¶ˆè€—</li>
          <li><strong>é”™è¯¯å¤„ç†ï¼š</strong>å»ºè®®å®ç°é‡è¯•æœºåˆ¶ï¼Œå¤„ç†ç½‘ç»œè¶…æ—¶å’Œä¸´æ—¶é”™è¯¯</li>
          <li><strong>æ—¥å¿—è®°å½•ï¼š</strong>åœ¨"æ—¥å¿—æŸ¥çœ‹"é¡µé¢å¯æŸ¥çœ‹æ‰€æœ‰APIè¯·æ±‚è®°å½•</li>
        </ul>
      </div>

      <div class="card">
        <h3>ğŸ”— å¸¸è§é›†æˆæ–¹å¼</h3>
        <div style="margin-bottom: 20px;">
          <h4 style="color: #667eea; margin-bottom: 10px;">Python (OpenAI SDK)</h4>
          <div class="code-block">from openai import OpenAI

client = OpenAI(
    api_key="YOUR_API_KEY",
    base_url="http://localhost:8045/v1"
)

response = client.chat.completions.create(
    model="gemini-2.0-flash-exp",
    messages=[
        {"role": "user", "content": "ä½ å¥½"}
    ],
    stream=True
)

for chunk in response:
    print(chunk.choices[0].delta.content or "", end="")</div>
        </div>

        <div style="margin-bottom: 20px;">
          <h4 style="color: #667eea; margin-bottom: 10px;">JavaScript (Fetch API)</h4>
          <div class="code-block">const response = await fetch('http://localhost:8045/v1/chat/completions', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer YOUR_API_KEY'
  },
  body: JSON.stringify({
    model: 'gemini-2.0-flash-exp',
    messages: [{ role: 'user', content: 'ä½ å¥½' }],
    stream: true
  })
});

const reader = response.body.getReader();
const decoder = new TextDecoder();

while (true) {
  const { done, value } = await reader.read();
  if (done) break;

  const text = decoder.decode(value);
  console.log(text);
}</div>
        </div>

        <div>
          <h4 style="color: #667eea; margin-bottom: 10px;">Node.js (OpenAI SDK)</h4>
          <div class="code-block">import OpenAI from 'openai';

const client = new OpenAI({
  apiKey: 'YOUR_API_KEY',
  baseURL: 'http://localhost:8045/v1'
});

const stream = await client.chat.completions.create({
  model: 'gemini-2.0-flash-exp',
  messages: [{ role: 'user', content: 'ä½ å¥½' }],
  stream: true
});

for await (const chunk of stream) {
  process.stdout.write(chunk.choices[0]?.delta?.content || '');
}</div>
        </div>
      </div>
    </div>

    <!-- æ—¥å¿—æŸ¥çœ‹ -->
    <div id="logs" class="tab-content">
      <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
          <h3 style="margin: 0;">å®æ—¶æ—¥å¿—</h3>
          <label class="auto-refresh">
            <input type="checkbox" id="autoRefreshLogs" onchange="toggleAutoRefresh('logs')">
            <span>è‡ªåŠ¨åˆ·æ–°</span>
          </label>
        </div>

        <!-- æ—¥å¿—è¿‡æ»¤å™¨ -->
        <div class="log-filters">
          <button class="filter-btn active" onclick="filterLogs('all')" data-filter="all">å…¨éƒ¨</button>
          <button class="filter-btn" onclick="filterLogs('info')" data-filter="info">ä¿¡æ¯</button>
          <button class="filter-btn" onclick="filterLogs('success')" data-filter="success">æˆåŠŸ</button>
          <button class="filter-btn" onclick="filterLogs('warn')" data-filter="warn">è­¦å‘Š</button>
          <button class="filter-btn" onclick="filterLogs('error')" data-filter="error">é”™è¯¯</button>
          <input type="text" class="log-search" id="logSearch" placeholder="æœç´¢æ—¥å¿—..." oninput="searchLogs(this.value)">
        </div>

        <div class="flex-buttons">
          <button onclick="loadLogs()" class="btn-secondary">ç«‹å³åˆ·æ–°</button>
          <button onclick="exportLogs()" class="btn-warning">å¯¼å‡ºæ—¥å¿—</button>
          <button onclick="clearLogs()" class="btn-danger">æ¸…ç©ºæ—¥å¿—</button>
        </div>
      </div>
      <div id="logContainer">
        <div style="text-align: center; color: #999; padding: 20px;">åŠ è½½ä¸­...</div>
      </div>
      <div id="logStats" style="margin-top: 15px; padding: 15px; background: #f8fafc; border-radius: 8px; display: none;">
        <span style="font-weight: 600; color: var(--primary);">ç»Ÿè®¡ï¼š</span>
        <span id="logTotalCount">0</span> æ¡æ—¥å¿— |
        ä¿¡æ¯: <span id="logInfoCount">0</span> |
        æˆåŠŸ: <span id="logSuccessCount">0</span> |
        è­¦å‘Š: <span id="logWarnCount">0</span> |
        é”™è¯¯: <span id="logErrorCount">0</span>
      </div>
    </div>

    <!-- ç³»ç»Ÿç›‘æ§ -->
    <div id="monitor" class="tab-content">
      <div style="display: flex; justify-content: flex-end; margin-bottom: 20px;">
        <label class="auto-refresh">
          <input type="checkbox" id="autoRefreshMonitor" onchange="toggleAutoRefresh('monitor')">
          <span>è‡ªåŠ¨åˆ·æ–°</span>
        </label>
      </div>

      <div class="status-grid">
        <div class="status-card">
          <h3>CPU ä½¿ç”¨ç‡</h3>
          <div class="value" id="cpuUsage">-</div>
        </div>
        <div class="status-card">
          <h3>å†…å­˜ä½¿ç”¨</h3>
          <div class="value" id="memoryUsage">-</div>
        </div>
        <div class="status-card">
          <h3>è¿è¡Œæ—¶é—´</h3>
          <div class="value" id="uptime">-</div>
        </div>
        <div class="status-card">
          <h3>æ€»è¯·æ±‚æ•°</h3>
          <div class="value" id="totalRequests">-</div>
        </div>
        <div class="status-card">
          <h3>æœåŠ¡å™¨çŠ¶æ€</h3>
          <div class="value" id="idleStatus" style="font-size: 1.2em;">-</div>
          <small style="color: #7f8c8d; font-size: 0.7em; display: block; margin-top: 5px;">ç©ºé—²æ—¶é—´: <span id="idleTime">0</span>ç§’</small>
        </div>
      </div>

      <div class="card">
        <h3>Token è½®è¯¢ä½¿ç”¨ç»Ÿè®¡</h3>
        <div id="tokenUsageStats">åŠ è½½ä¸­...</div>
      </div>

      <div class="card">
        <h3>ç³»ç»Ÿä¿¡æ¯</h3>
        <div id="systemInfo">åŠ è½½ä¸­...</div>
      </div>

      <button onclick="loadMonitorData()" class="btn-secondary">ç«‹å³åˆ·æ–°</button>
    </div>

    <!-- ç³»ç»Ÿè®¾ç½® -->
    <div id="settings" class="tab-content">
      <div class="card">
        <h3>æœåŠ¡å™¨é…ç½®</h3>
        <div class="form-group">
          <label>æœåŠ¡ç«¯å£</label>
          <input type="number" id="settingPort" placeholder="8045">
        </div>
        <div class="form-group">
          <label>ç›‘å¬åœ°å€</label>
          <input type="text" id="settingHost" placeholder="0.0.0.0">
        </div>
      </div>

      <div class="card">
        <h3>å®‰å…¨é…ç½®</h3>
        <div class="form-group">
          <label>é»˜è®¤ API å¯†é’¥</label>
          <input type="text" id="settingApiKey" placeholder="sk-text">
          <small style="color: #7f8c8d; display: block; margin-top: 5px;">æ­¤å¯†é’¥ä¸å—é¢‘ç‡é™åˆ¶çº¦æŸ</small>
        </div>
        <div class="form-group">
          <label>ç®¡ç†å‘˜å¯†ç </label>
          <input type="password" id="settingAdminPassword" placeholder="admin123">
        </div>
        <div class="form-group">
          <label>æœ€å¤§è¯·æ±‚ä½“å¤§å°</label>
          <input type="text" id="settingMaxRequestSize" placeholder="50mb">
        </div>
      </div>

      <div class="card">
        <h3>æ¨¡å‹é»˜è®¤å‚æ•°</h3>
        <div class="form-group">
          <label>Temperature</label>
          <input type="number" id="settingTemperature" step="0.1" min="0" max="2" placeholder="1">
        </div>
        <div class="form-group">
          <label>Top P</label>
          <input type="number" id="settingTopP" step="0.01" min="0" max="1" placeholder="0.85">
        </div>
        <div class="form-group">
          <label>Top K</label>
          <input type="number" id="settingTopK" min="1" placeholder="50">
        </div>
        <div class="form-group">
          <label>æœ€å¤§ Token æ•°</label>
          <input type="number" id="settingMaxTokens" min="1" placeholder="8096">
        </div>
      </div>

      <div class="card">
        <h3>ç³»ç»ŸæŒ‡ä»¤</h3>
        <div class="form-group">
          <label>System Instruction</label>
          <textarea id="settingSystemInstruction" rows="5" placeholder="è¾“å…¥ç³»ç»Ÿæç¤ºè¯..."></textarea>
        </div>
      </div>

      <div class="card">
        <h3>Google OAuth é…ç½®</h3>
        <small style="color: #7f8c8d; display: block; margin-bottom: 15px;">ç”¨äºè·å– Google Tokenï¼Œå‰ç«¯å’Œ OAuth ç™»å½•æœåŠ¡å…±ç”¨æ­¤é…ç½®</small>
        <div class="form-group">
          <label>Client ID</label>
          <input type="text" id="settingOAuthClientId" placeholder="è¾“å…¥ Google OAuth Client ID">
        </div>
        <div class="form-group">
          <label>Client Secret</label>
          <input type="password" id="settingOAuthClientSecret" placeholder="è¾“å…¥ Google OAuth Client Secret">
        </div>
      </div>

      <div class="flex-buttons">
        <button onclick="loadSettings()" class="btn-secondary">é‡æ–°åŠ è½½</button>
        <button onclick="saveSettings()" class="btn-success">ä¿å­˜è®¾ç½®</button>
      </div>
    </div>
  </div>

  <!-- æ·±è‰²æ¨¡å¼åˆ‡æ¢æŒ‰é’® -->
  <button class="theme-toggle" onclick="toggleTheme()" title="åˆ‡æ¢ä¸»é¢˜">
    <span id="themeIcon">ğŸŒ™</span>
  </button>

  <script>
    const API_BASE = window.location.origin;
    let chatHistory = [];
    let autoRefreshIntervals = {};
    let adminToken = localStorage.getItem('adminToken') || '';
    let sessionToken = adminToken; // sessionTokenåˆ«å,ç”¨äºAIç®¡ç†ç­‰æ–°åŠŸèƒ½

    // è·å–å¸¦è®¤è¯çš„ headers
    function getAuthHeaders() {
      return {
        'Content-Type': 'application/json',
        'X-Admin-Token': adminToken,
        'X-Admin-Session': sessionToken
      };
    }

    // æ˜¾ç¤ºæ¶ˆæ¯æç¤º
    function showMessage(message, type = 'info') {
      const colors = {
        success: '#d1fae5',
        error: '#fee2e2',
        warning: '#fef3c7',
        info: '#dbeafe'
      };
      const textColors = {
        success: '#065f46',
        error: '#991b1b',
        warning: '#92400e',
        info: '#1e40af'
      };

      const msgDiv = document.createElement('div');
      msgDiv.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${colors[type] || colors.info};
        color: ${textColors[type] || textColors.info};
        padding: 16px 24px;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        z-index: 10000;
        max-width: 400px;
        animation: slideIn 0.3s ease-out;
      `;
      msgDiv.textContent = message;
      document.body.appendChild(msgDiv);

      setTimeout(() => {
        msgDiv.style.animation = 'slideOut 0.3s ease-out';
        setTimeout(() => msgDiv.remove(), 300);
      }, 3000);
    }

    // å¯†ç ç™»å½•
    async function doLogin() {
      const password = document.getElementById('loginPassword').value;
      const errorEl = document.getElementById('loginError');
      const btn = document.getElementById('loginBtn2');

      if (!password) {
        errorEl.textContent = 'è¯·è¾“å…¥å¯†ç ';
        return;
      }

      btn.disabled = true;
      btn.textContent = 'ç™»å½•ä¸­...';
      errorEl.textContent = '';

      try {
        const response = await fetch(`${API_BASE}/admin/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ password })
        });

        const data = await response.json();

        if (response.ok && data.success) {
          adminToken = data.token;
          sessionToken = data.token; // åŒæ­¥sessionToken
          localStorage.setItem('adminToken', adminToken);
          document.getElementById('loginOverlay').classList.add('hidden');
          loadHomeData();
        } else {
          errorEl.textContent = data.error || 'ç™»å½•å¤±è´¥';
        }
      } catch (error) {
        errorEl.textContent = 'ç™»å½•å¤±è´¥: ' + error.message;
      } finally {
        btn.disabled = false;
        btn.textContent = 'ä½¿ç”¨å¯†ç ç™»å½•';
      }
    }

    // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
    function showToast(message, type = 'info') {
      const toast = document.createElement('div');
      toast.style.cssText = `
        position: fixed;
        top: 80px;
        right: 20px;
        padding: 16px 24px;
        background: ${type === 'success' ? 'linear-gradient(135deg, #10b981 0%, #059669 100%)' :
                     type === 'error' ? 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)' :
                     'linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)'};
        color: white;
        border-radius: 12px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        z-index: 10000;
        font-weight: 600;
        animation: slideInRight 0.3s ease-out;
      `;
      toast.textContent = message;
      document.body.appendChild(toast);

      setTimeout(() => {
        toast.style.animation = 'slideOutRight 0.3s ease-in';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    // ç™»å‡º
    async function doLogout() {
      try {
        await fetch(`${API_BASE}/admin/logout`, {
          method: 'POST',
          headers: getAuthHeaders()
        });
      } catch (e) {}

      adminToken = '';
      sessionToken = '';
      localStorage.removeItem('adminToken');
      document.getElementById('loginOverlay').classList.remove('hidden');
      document.getElementById('loginPassword').value = '';
    }

    // éªŒè¯ä¼šè¯
    async function verifySession() {
      if (!adminToken) {
        return false;
      }

      try {
        const response = await fetch(`${API_BASE}/admin/verify`, {
          headers: { 'X-Admin-Token': adminToken }
        });
        return response.ok;
      } catch (e) {
        return false;
      }
    }

    // å¸¦è®¤è¯çš„ fetch å°è£…
    async function authFetch(url, options = {}) {
      const response = await fetch(url, {
        ...options,
        headers: {
          ...options.headers,
          'X-Admin-Token': adminToken
        }
      });

      if (response.status === 401) {
        doLogout();
        throw new Error('ä¼šè¯å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•');
      }

      return response;
    }

    // åˆ‡æ¢æ ‡ç­¾é¡µ
    function switchTab(tabName) {
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.nav-tab').forEach(btn => btn.classList.remove('active'));

      document.getElementById(tabName).classList.add('active');
      event.target.classList.add('active');

      // åŠ è½½å¯¹åº”æ•°æ®
      if (tabName === 'tokens') loadTokens();
      if (tabName === 'keys') loadKeys();
      if (tabName === 'logs') loadLogs();
      if (tabName === 'monitor') loadMonitorData();
      if (tabName === 'home') loadHomeData();
      if (tabName === 'test') loadModels();
      if (tabName === 'settings') loadSettings();
      if (tabName === 'announcements') loadAnnouncements();
      if (tabName === 'users') loadUsers();
    }

    // è‡ªåŠ¨åˆ·æ–°åŠŸèƒ½
    function toggleAutoRefresh(type) {
      const checkbox = document.getElementById(`autoRefresh${type.charAt(0).toUpperCase() + type.slice(1)}`);
      const intervalId = `${type}Interval`;

      if (checkbox.checked) {
        // å¯åŠ¨è‡ªåŠ¨åˆ·æ–° (æ¯5ç§’)
        if (type === 'logs') {
          autoRefreshIntervals[intervalId] = setInterval(loadLogs, 5000);
        } else if (type === 'monitor') {
          autoRefreshIntervals[intervalId] = setInterval(loadMonitorData, 5000);
        }
      } else {
        // åœæ­¢è‡ªåŠ¨åˆ·æ–°
        if (autoRefreshIntervals[intervalId]) {
          clearInterval(autoRefreshIntervals[intervalId]);
          delete autoRefreshIntervals[intervalId];
        }
      }
    }

    // é¦–é¡µæ•°æ®
    async function loadHomeData() {
      try {
        const [keys, tokens, keyStats, tokenStats, status] = await Promise.all([
          authFetch(`${API_BASE}/admin/keys`).then(r => r.json()),
          authFetch(`${API_BASE}/admin/tokens`).then(r => r.json()),
          authFetch(`${API_BASE}/admin/keys/stats`).then(r => r.json()).catch(() => ({ totalRequests: 0 })),
          authFetch(`${API_BASE}/admin/tokens/stats`).then(r => r.json()).catch(() => ({ enabled: 0, disabled: 0 })),
          authFetch(`${API_BASE}/admin/status`).then(r => r.json()).catch(() => null)
        ]);

        // åŸºç¡€ç»Ÿè®¡
        document.getElementById('keyCount').textContent = keys.length;
        document.getElementById('tokenCount').textContent = tokens.length;
        document.getElementById('keyRequests').textContent = keyStats.totalRequests || 0;
        document.getElementById('tokenEnabled').textContent = tokenStats.enabled || 0;
        document.getElementById('tokenDisabled').textContent = tokenStats.disabled || 0;

        // ç³»ç»Ÿæ€§èƒ½æ•°æ®
        if (status) {
          document.getElementById('homeCpu').textContent = status.cpu + '%';
          document.getElementById('homeMemory').textContent = status.memory;
          document.getElementById('homeUptime').textContent = status.uptime;
          document.getElementById('homeTotalRequests').textContent = status.requests || 0;

          // ç©ºé—²çŠ¶æ€
          const idleStatusEl = document.getElementById('homeIdleStatus');
          idleStatusEl.textContent = status.idle || 'æ´»è·ƒ';
          idleStatusEl.style.color = status.idle === 'ç©ºé—²æ¨¡å¼' ? '#f59e0b' : '#10b981';
          document.getElementById('homeIdleTime').textContent = (status.idleTime || 0) + ' ç§’';
        }

        // Token è½®è¯¢æ•°æ®
        let usageData = { totalTokens: 0, currentIndex: 0, totalRequests: 0, tokens: [] };
        try {
          const usageResponse = await authFetch(`${API_BASE}/admin/tokens/usage`);
          usageData = await usageResponse.json();
        } catch (e) {
          console.log('Token ä½¿ç”¨ç»Ÿè®¡æš‚ä¸å¯ç”¨');
        }

        document.getElementById('homeTotalTokens').textContent = usageData.totalTokens || 0;
        document.getElementById('homeCurrentIndex').textContent = '#' + (usageData.currentIndex || 0);
        document.getElementById('homeRotationRequests').textContent = usageData.totalRequests || 0;

        // è®¾ç½®åŸºç¡€ URL
        document.getElementById('homeBaseUrl').textContent = API_BASE;
      } catch (error) {
        console.error('åŠ è½½é¦–é¡µæ•°æ®å¤±è´¥:', error);
      }
    }

    // Token ç®¡ç†
    async function triggerGoogleLogin() {
      const btn = document.getElementById('loginBtn');
      const resultEl = document.getElementById('loginResult');

      btn.disabled = true;
      btn.textContent = 'ç™»å½•ä¸­...';
      resultEl.innerHTML = '<div class="alert alert-info">æ­£åœ¨å¯åŠ¨ç™»å½•æµç¨‹...</div>';

      try {
        const response = await authFetch(`${API_BASE}/admin/tokens/login`, {
          method: 'POST'
        });
        const data = await response.json();

        if (data.success && data.authUrl) {
          resultEl.innerHTML = `
            <div class="alert alert-success">
              <p><strong>ç™»å½•æµç¨‹å·²å¯åŠ¨ï¼</strong></p>
              <p style="margin: 10px 0;">è¯·åœ¨æ‰“å¼€çš„æµè§ˆå™¨çª—å£ä¸­å®Œæˆ Google æˆæƒã€‚</p>
              <a href="${data.authUrl}" target="_blank" class="btn-success" style="display: inline-block; text-decoration: none; margin-top: 10px;">ç‚¹å‡»è¿™é‡Œæ‰“å¼€æˆæƒé¡µé¢</a>
            </div>
          `;
          // è‡ªåŠ¨æ‰“å¼€æˆæƒé¡µé¢
          window.open(data.authUrl, '_blank');
          // 10ç§’ååˆ·æ–°Tokenåˆ—è¡¨
          setTimeout(() => {
            loadTokens();
            resultEl.innerHTML = '<div class="alert alert-info">æˆæƒå®Œæˆåï¼ŒToken å°†è‡ªåŠ¨æ·»åŠ åˆ°åˆ—è¡¨ä¸­ã€‚å¦‚æœªçœ‹åˆ°ï¼Œè¯·ç‚¹å‡»"åˆ·æ–°åˆ—è¡¨"æŒ‰é’®ã€‚</div>';
          }, 10000);
        } else {
          resultEl.innerHTML = `<div class="alert alert-error">${data.message || 'ç™»å½•å¤±è´¥'}</div>`;
        }
      } catch (error) {
        resultEl.innerHTML = `<div class="alert alert-error">ç™»å½•å¤±è´¥: ${error.message}</div>`;
      } finally {
        btn.disabled = false;
        btn.textContent = 'ç™»å½•è·å– Token';
      }
    }

    let selectedTokens = new Set();

    async function loadTokens() {
      try {
        const response = await authFetch(`${API_BASE}/admin/tokens`);
        const tokens = await response.json();
        const container = document.getElementById('tokenList');

        if (tokens.length === 0) {
          container.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">æš‚æ—  Token è´¦å·</div>';
          return;
        }

        // è·å–è´¦å·åç§°
        const indices = tokens.map(t => t.index);
        let accountNames = {};
        try {
          const detailsResponse = await authFetch(`${API_BASE}/admin/tokens/details`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ indices })
          });
          const details = await detailsResponse.json();
          details.forEach(d => {
            accountNames[d.index] = { email: d.email, name: d.name };
          });
        } catch (e) {
          console.error('è·å–è´¦å·åç§°å¤±è´¥:', e);
        }

        container.innerHTML = tokens.map(token => {
          const accountInfo = accountNames[token.index] || { email: 'Unknown', name: 'Unknown' };
          return `
            <div class="token-item">
              <div style="margin-bottom: 10px;">
                <input type="checkbox" id="token-${token.index}" onchange="toggleTokenSelection(${token.index})" ${selectedTokens.has(token.index) ? 'checked' : ''} style="width: auto; margin-right: 10px;">
                <strong style="color: #2c3e50; font-size: 1.1em;">${accountInfo.name}</strong>
                <small style="color: #7f8c8d; margin-left: 10px;">(${accountInfo.email})</small>
                ${token.enable ?
                  '<span style="background: #27ae60; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.8em; margin-left: 10px;">å·²å¯ç”¨</span>' :
                  '<span style="background: #95a5a6; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.8em; margin-left: 10px;">å·²ç¦ç”¨</span>'
                }
              </div>
              <div class="key-value" style="margin-bottom: 10px;">${token.access_token}</div>
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <small style="color: #7f8c8d;">åˆ›å»ºæ—¶é—´: ${token.created}</small>
                  <small style="color: #7f8c8d; margin-left: 15px;">è¿‡æœŸæ—¶é—´: ${token.expires_in}ç§’</small>
                </div>
                <div class="flex-buttons">
                  <button onclick="toggleToken(${token.index}, ${!token.enable})" class="btn-warning" style="padding: 8px 16px;">
                    ${token.enable ? 'ç¦ç”¨' : 'å¯ç”¨'}
                  </button>
                  <button onclick="deleteToken(${token.index})" class="btn-danger" style="padding: 8px 16px;">åˆ é™¤</button>
                </div>
              </div>
            </div>
          `;
        }).join('');
      } catch (error) {
        document.getElementById('tokenList').innerHTML =
          `<div class="alert alert-error">åŠ è½½ Token å¤±è´¥: ${error.message}</div>`;
      }
    }

    function toggleTokenSelection(index) {
      const checkbox = document.getElementById(`token-${index}`);
      if (checkbox && checkbox.checked) {
        selectedTokens.add(index);
      } else {
        selectedTokens.delete(index);
      }
    }

    function selectAllTokens() {
      const checkboxes = document.querySelectorAll('[id^="token-"]');
      const allChecked = Array.from(checkboxes).every(cb => cb.checked);

      checkboxes.forEach(cb => {
        cb.checked = !allChecked;
        const index = parseInt(cb.id.replace('token-', ''));
        if (cb.checked) {
          selectedTokens.add(index);
        } else {
          selectedTokens.delete(index);
        }
      });
    }

    async function exportSelectedTokens() {
      if (selectedTokens.size === 0) {
        alert('è¯·å…ˆé€‰æ‹©è¦å¯¼å‡ºçš„è´¦å·');
        return;
      }

      try {
        const response = await authFetch(`${API_BASE}/admin/tokens/export`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ indices: Array.from(selectedTokens) })
        });

        // ä¸‹è½½ä¸º ZIP æ–‡ä»¶
        const blob = await response.blob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `tokens_export_${new Date().toISOString().split('T')[0]}.zip`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        alert(`æˆåŠŸå¯¼å‡º ${selectedTokens.size} ä¸ªè´¦å·`);
      } catch (error) {
        alert('å¯¼å‡ºå¤±è´¥: ' + error.message);
      }
    }

    // å¯¼å…¥ Token
    async function importTokens() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.zip';

      input.onchange = async (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const formData = new FormData();
        formData.append('file', file);

        try {
          const response = await fetch(`${API_BASE}/admin/tokens/import`, {
            method: 'POST',
            headers: {
              'X-Admin-Token': adminToken
            },
            body: formData
          });

          const result = await response.json();
          if (response.ok) {
            alert(result.message || 'å¯¼å…¥æˆåŠŸï¼');
            loadTokens();
          } else {
            alert('å¯¼å…¥å¤±è´¥: ' + (result.error || 'æœªçŸ¥é”™è¯¯'));
          }
        } catch (error) {
          alert('å¯¼å…¥å¤±è´¥: ' + error.message);
        }
      };

      input.click();
    }

    async function toggleToken(index, enable) {
      try {
        await authFetch(`${API_BASE}/admin/tokens/${index}`, {
          method: 'PATCH',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ enable })
        });
        loadTokens();
      } catch (error) {
        alert(`${enable ? 'å¯ç”¨' : 'ç¦ç”¨'}Token å¤±è´¥: ` + error.message);
      }
    }

    async function deleteToken(index) {
      if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ª Token è´¦å·å—ï¼Ÿ')) return;
      try {
        await authFetch(`${API_BASE}/admin/tokens/${index}`, {
          method: 'DELETE'
        });
        loadTokens();
      } catch (error) {
        alert('åˆ é™¤ Token å¤±è´¥: ' + error.message);
      }
    }

    // æ‰‹åŠ¨æ·»åŠ  Tokenï¼ˆå›è°ƒé“¾æ¥ï¼‰
    async function addTokenManually() {
      const callbackUrl = document.getElementById('callbackUrl').value.trim();
      const btn = document.getElementById('addTokenBtn');
      const resultEl = document.getElementById('addTokenResult');

      if (!callbackUrl) {
        resultEl.innerHTML = '<div class="alert alert-error">è¯·è¾“å…¥å›è°ƒé“¾æ¥</div>';
        return;
      }

      btn.disabled = true;
      btn.textContent = 'æ·»åŠ ä¸­...';
      resultEl.innerHTML = '<div class="alert alert-info">æ­£åœ¨å¤„ç†å›è°ƒé“¾æ¥...</div>';

      try {
        const response = await authFetch(`${API_BASE}/admin/tokens/callback`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ callbackUrl })
        });
        const data = await response.json();

        if (response.ok && data.success) {
          resultEl.innerHTML = '<div class="alert alert-success">Token æ·»åŠ æˆåŠŸï¼</div>';
          document.getElementById('callbackUrl').value = '';
          loadTokens();
        } else {
          resultEl.innerHTML = `<div class="alert alert-error">${data.error || 'æ·»åŠ å¤±è´¥'}</div>`;
        }
      } catch (error) {
        resultEl.innerHTML = `<div class="alert alert-error">æ·»åŠ å¤±è´¥: ${error.message}</div>`;
      } finally {
        btn.disabled = false;
        btn.textContent = 'æ·»åŠ  Token';
      }
    }

    // æ‰‹åŠ¨æ·»åŠ  Tokenï¼ˆç›´æ¥è¾“å…¥ï¼‰
    async function addDirectToken() {
      const accessToken = document.getElementById('directAccessToken').value.trim();
      const refreshToken = document.getElementById('directRefreshToken').value.trim();
      const expiresIn = parseInt(document.getElementById('directExpiresIn').value) || 3600;
      const btn = document.getElementById('addDirectTokenBtn');
      const resultEl = document.getElementById('addDirectTokenResult');

      // éªŒè¯å¿…å¡«é¡¹
      if (!accessToken) {
        resultEl.innerHTML = '<div class="alert alert-error">è¯·è¾“å…¥ Access Token</div>';
        document.getElementById('directAccessToken').focus();
        return;
      }

      btn.disabled = true;
      btn.textContent = 'æ·»åŠ ä¸­...';
      resultEl.innerHTML = '<div class="alert alert-info">æ­£åœ¨æ·»åŠ  Token...</div>';

      try {
        const response = await authFetch(`${API_BASE}/admin/tokens/direct`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            access_token: accessToken,
            refresh_token: refreshToken || null,
            expires_in: expiresIn
          })
        });
        const data = await response.json();

        if (response.ok && data.success) {
          resultEl.innerHTML = '<div class="alert alert-success">âœ“ Token æ·»åŠ æˆåŠŸï¼å·²æ·»åŠ åˆ°è´¦å·åˆ—è¡¨ã€‚</div>';

          // æ¸…ç©ºè¡¨å•
          document.getElementById('directAccessToken').value = '';
          document.getElementById('directRefreshToken').value = '';
          document.getElementById('directExpiresIn').value = '3600';

          // åˆ·æ–° Token åˆ—è¡¨
          loadTokens();

          // æ˜¾ç¤ºæˆåŠŸæç¤º
          showToast('Token æ·»åŠ æˆåŠŸï¼', 'success');
        } else {
          resultEl.innerHTML = `<div class="alert alert-error">âœ— ${data.error || 'æ·»åŠ å¤±è´¥'}</div>`;
        }
      } catch (error) {
        resultEl.innerHTML = `<div class="alert alert-error">âœ— æ·»åŠ å¤±è´¥: ${error.message}</div>`;
        console.error('æ·»åŠ  Token é”™è¯¯:', error);
      } finally {
        btn.disabled = false;
        btn.textContent = 'æ·»åŠ  Token';
      }
    }

    // åˆ‡æ¢é¢‘ç‡é™åˆ¶å­—æ®µæ˜¾ç¤º
    function toggleRateLimitFields() {
      const enabled = document.getElementById('enableRateLimit').checked;
      document.getElementById('rateLimitFields').style.display = enabled ? 'block' : 'none';
    }

    // ç”Ÿæˆå¯†é’¥
    async function generateKey() {
      const name = document.getElementById('keyName').value || 'æœªå‘½å';
      const enableRateLimit = document.getElementById('enableRateLimit').checked;

      let rateLimit = null;
      if (enableRateLimit) {
        const maxRequests = parseInt(document.getElementById('maxRequests').value) || 100;
        const windowSeconds = parseInt(document.getElementById('windowSeconds').value) || 60;
        rateLimit = {
          enabled: true,
          maxRequests,
          windowMs: windowSeconds * 1000
        };
      }

      try {
        const response = await authFetch(`${API_BASE}/admin/keys/generate`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, rateLimit })
        });
        const data = await response.json();
        if (data.key) {
          alert(`å¯†é’¥ç”ŸæˆæˆåŠŸï¼\n\n${data.key}\n\nè¯·å¦¥å–„ä¿å­˜ï¼Œæ­¤å¯†é’¥ä¸ä¼šå†æ¬¡æ˜¾ç¤ºï¼`);
          document.getElementById('keyName').value = '';
          document.getElementById('enableRateLimit').checked = false;
          toggleRateLimitFields();
          loadKeys();
        }
      } catch (error) {
        alert('ç”Ÿæˆå¯†é’¥å¤±è´¥: ' + error.message);
      }
    }

    // åŠ è½½å¯†é’¥åˆ—è¡¨
    async function loadKeys() {
      try {
        const response = await authFetch(`${API_BASE}/admin/keys`);
        const keys = await response.json();
        const listEl = document.getElementById('keyList');

        if (keys.length === 0) {
          listEl.innerHTML = '<li style="text-align: center; color: #999;">æš‚æ— å¯†é’¥</li>';
          return;
        }

        listEl.innerHTML = keys.map(key => {
          const rateLimitInfo = key.rateLimit && key.rateLimit.enabled
            ? `<span style="background: #f39c12; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.8em; margin-left: 10px;">é™åˆ¶: ${key.rateLimit.maxRequests}æ¬¡/${key.rateLimit.windowMs/1000}ç§’</span>`
            : '<span style="background: #3498db; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.8em; margin-left: 10px;">æ— é™åˆ¶</span>';

          return `
            <li class="key-item">
              <div style="flex: 1;">
                <div style="margin-bottom: 10px;">
                  <strong style="color: #2c3e50; font-size: 1.1em;">${key.name}</strong>
                  ${key.lastUsed ? `<span style="background: #27ae60; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.8em; margin-left: 10px;">å·²ä½¿ç”¨</span>` : `<span style="background: #95a5a6; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.8em; margin-left: 10px;">æœªä½¿ç”¨</span>`}
                  ${rateLimitInfo}
                </div>
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                  <div class="key-value" style="margin: 0; flex: 1;">${key.key}</div>
                  <button class="copy-btn" onclick="copyToClipboard('${key.key}', this)">å¤åˆ¶</button>
                </div>
                <small style="color: #7f8c8d;">åˆ›å»ºæ—¶é—´: ${new Date(key.created).toLocaleString()}</small>
                ${key.lastUsed ? `<small style="color: #7f8c8d; margin-left: 15px;">ä¸Šæ¬¡ä½¿ç”¨: ${new Date(key.lastUsed).toLocaleString()}</small>` : ''}
                ${key.requests ? `<small style="color: #7f8c8d; margin-left: 15px;">è¯·æ±‚æ¬¡æ•°: ${key.requests}</small>` : ''}
              </div>
              <button class="btn-danger" onclick="deleteKey('${key.key}')">åˆ é™¤</button>
            </li>
          `;
        }).join('');
      } catch (error) {
        console.error('åŠ è½½å¯†é’¥å¤±è´¥:', error);
      }
    }

    // åˆ é™¤å¯†é’¥
    async function deleteKey(key) {
      if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå¯†é’¥å—ï¼Ÿ')) return;
      try {
        await authFetch(`${API_BASE}/admin/keys/${encodeURIComponent(key)}`, {
          method: 'DELETE'
        });
        loadKeys();
      } catch (error) {
        alert('åˆ é™¤å¯†é’¥å¤±è´¥: ' + error.message);
      }
    }

    // é»˜è®¤ Gemini æ¨¡å‹åˆ—è¡¨
    const DEFAULT_MODELS = [
      'gemini-2.0-flash-exp',
      'gemini-exp-1206',
      'gemini-1.5-pro',
      'gemini-1.5-flash',
      'gemini-1.5-flash-8b'
    ];

    // åŠ è½½æ¨¡å‹åˆ—è¡¨
    async function loadModels() {
      const select = document.getElementById('testModel');
      const refreshBtn = event?.target;

      if (refreshBtn) {
        refreshBtn.disabled = true;
        refreshBtn.textContent = 'åˆ·æ–°ä¸­...';
      }

      select.innerHTML = '<option value="">åŠ è½½ä¸­...</option>';

      try {
        // å…ˆå°è¯•ä»è®¾ç½®ä¸­è·å–é»˜è®¤APIå¯†é’¥
        let apiKey = document.getElementById('testApiKey').value;
        if (!apiKey) {
          try {
            const settingsResponse = await authFetch(`${API_BASE}/admin/settings`);
            const settings = await settingsResponse.json();
            apiKey = settings.security?.apiKey || 'sk-default';
          } catch (e) {
            apiKey = 'sk-default';
          }
        }

        const response = await fetch(`${API_BASE}/v1/models`, {
          headers: {
            'Authorization': 'Bearer ' + apiKey
          }
        });

        if (!response.ok) {
          const errorData = await response.json().catch(() => ({ error: 'æœªçŸ¥é”™è¯¯' }));
          throw new Error(errorData.error || `HTTP ${response.status}`);
        }

        const data = await response.json();
        if (data.data && data.data.length > 0) {
          select.innerHTML = data.data.map(model =>
            `<option value="${model.id}">${model.id}</option>`
          ).join('');
          showToast('æ¨¡å‹åˆ—è¡¨å·²æ›´æ–°', 'success');
        } else {
          // æ²¡æœ‰æ¨¡å‹æ•°æ®ï¼Œä½¿ç”¨é»˜è®¤åˆ—è¡¨
          select.innerHTML = DEFAULT_MODELS.map(model =>
            `<option value="${model}">${model}</option>`
          ).join('');
          showToast('ä½¿ç”¨é»˜è®¤æ¨¡å‹åˆ—è¡¨', 'info');
        }
      } catch (error) {
        console.error('åŠ è½½æ¨¡å‹å¤±è´¥:', error);

        // å›é€€åˆ°é»˜è®¤ Gemini æ¨¡å‹åˆ—è¡¨
        select.innerHTML = DEFAULT_MODELS.map(model =>
          `<option value="${model}">${model}</option>`
        ).join('');

        // æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤º
        const errorMsg = error.message || 'æœªçŸ¥é”™è¯¯';
        if (errorMsg.includes('æ²¡æœ‰å¯ç”¨çš„token') || errorMsg.includes('token')) {
          showToast('âš ï¸ è¯·å…ˆåœ¨ Token ç®¡ç†é¡µé¢æ·»åŠ  Google Token', 'error');
        } else {
          showToast(`åŠ è½½å¤±è´¥: ${errorMsg.substring(0, 50)}`, 'error');
        }
      } finally {
        if (refreshBtn) {
          refreshBtn.disabled = false;
          refreshBtn.textContent = 'åˆ·æ–°æ¨¡å‹åˆ—è¡¨';
        }
      }
    }

    // å‘é€æµ‹è¯•æ¶ˆæ¯
    async function sendTestMessage() {
      const message = document.getElementById('testMessage').value;
      const model = document.getElementById('testModel').value;
      const apiKey = document.getElementById('testApiKey').value;

      if (!message) {
        alert('è¯·è¾“å…¥æ¶ˆæ¯å†…å®¹');
        return;
      }

      if (!apiKey) {
        alert('è¯·è¾“å…¥ API å¯†é’¥');
        return;
      }

      if (!model) {
        alert('è¯·é€‰æ‹©æ¨¡å‹');
        return;
      }

      chatHistory.push({ role: 'user', content: message });
      displayMessage('user', message);
      document.getElementById('testMessage').value = '';

      const sendBtn = document.getElementById('sendBtn');
      sendBtn.disabled = true;
      sendBtn.innerHTML = '<span class="loading"></span> å‘é€ä¸­...';

      try {
        const response = await fetch(`${API_BASE}/v1/chat/completions`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${apiKey}`
          },
          body: JSON.stringify({
            model,
            messages: chatHistory,
            stream: true
          })
        });

        const reader = response.body.getReader();
        const decoder = new TextDecoder();
        let assistantMessage = '';
        const messageEl = displayMessage('assistant', '');

        while (true) {
          const { done, value } = await reader.read();
          if (done) break;

          const text = decoder.decode(value);
          const lines = text.split('\n').filter(line => line.trim().startsWith('data: '));

          for (const line of lines) {
            const data = line.replace('data: ', '');
            if (data === '[DONE]') continue;

            try {
              const json = JSON.parse(data);
              const content = json.choices[0]?.delta?.content || '';
              assistantMessage += content;
              messageEl.textContent = assistantMessage;
            } catch (e) {}
          }
        }

        chatHistory.push({ role: 'assistant', content: assistantMessage });
      } catch (error) {
        displayMessage('assistant', 'é”™è¯¯: ' + error.message);
      } finally {
        sendBtn.disabled = false;
        sendBtn.textContent = 'å‘é€æ¶ˆæ¯';
      }
    }

    function displayMessage(role, content) {
      const container = document.getElementById('chatMessages');
      const messageEl = document.createElement('div');
      messageEl.className = `message ${role}`;
      messageEl.textContent = content;
      container.appendChild(messageEl);
      container.scrollTop = container.scrollHeight;
      return messageEl;
    }

    function clearChat() {
      chatHistory = [];
      document.getElementById('chatMessages').innerHTML = '';
    }

    // åŠ è½½æ—¥å¿—
    async function loadLogs() {
      try {
        const response = await authFetch(`${API_BASE}/admin/logs`);
        const logs = await response.json();

        // å­˜å‚¨æ—¥å¿—ä»¥ä¾›è¿‡æ»¤å’Œæœç´¢
        currentLogs = logs;

        if (logs.length === 0) {
          document.getElementById('logContainer').innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">æš‚æ— æ—¥å¿—</div>';
          document.getElementById('logStats').style.display = 'none';
          return;
        }

        // ä½¿ç”¨æ–°çš„æ¸²æŸ“ç³»ç»Ÿ
        renderLogs();
      } catch (error) {
        document.getElementById('logContainer').innerHTML =
          `<div class="alert alert-error">åŠ è½½æ—¥å¿—å¤±è´¥: ${error.message}</div>`;
      }
    }

    // æ¸…ç©ºæ—¥å¿—
    async function clearLogs() {
      if (!confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ—¥å¿—å—ï¼Ÿ')) return;
      try {
        await authFetch(`${API_BASE}/admin/logs`, { method: 'DELETE' });
        loadLogs();
      } catch (error) {
        alert('æ¸…ç©ºæ—¥å¿—å¤±è´¥: ' + error.message);
      }
    }

    // åŠ è½½ç›‘æ§æ•°æ®
    async function loadMonitorData() {
      try {
        const statusResponse = await authFetch(`${API_BASE}/admin/status`);
        const data = await statusResponse.json();

        // å°è¯•è·å– Token ä½¿ç”¨ç»Ÿè®¡ï¼ˆå¯èƒ½éœ€è¦é‡å¯æœåŠ¡å™¨æ‰å¯ç”¨ï¼‰
        let usageData = { totalTokens: 0, currentIndex: 0, totalRequests: 0, tokens: [] };
        try {
          const usageResponse = await authFetch(`${API_BASE}/admin/tokens/usage`);
          usageData = await usageResponse.json();
        } catch (e) {
          console.log('Token ä½¿ç”¨ç»Ÿè®¡æš‚ä¸å¯ç”¨ï¼ˆéœ€è¦é‡å¯æœåŠ¡å™¨ï¼‰');
        }

        document.getElementById('cpuUsage').textContent = data.cpu + '%';
        document.getElementById('memoryUsage').textContent = data.memory;
        document.getElementById('uptime').textContent = data.uptime;
        document.getElementById('totalRequests').textContent = data.requests;

        // æ˜¾ç¤ºç©ºé—²çŠ¶æ€
        const idleStatusEl = document.getElementById('idleStatus');
        idleStatusEl.textContent = data.idle || 'æ´»è·ƒ';
        idleStatusEl.style.color = data.idle === 'ç©ºé—²æ¨¡å¼' ? '#f39c12' : '#27ae60';
        document.getElementById('idleTime').textContent = data.idleTime || 0;

        // æ˜¾ç¤º Token ä½¿ç”¨ç»Ÿè®¡
        const usageContainer = document.getElementById('tokenUsageStats');
        if (usageData.totalTokens === 0) {
          usageContainer.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">æš‚æ—  Token è´¦å·</div>';
        } else {
          usageContainer.innerHTML = `
            <div style="margin-bottom: 15px;">
              <span style="background: #667eea; color: white; padding: 5px 12px; border-radius: 4px; margin-right: 10px;">
                æ€» Token æ•°: ${usageData.totalTokens}
              </span>
              <span style="background: #27ae60; color: white; padding: 5px 12px; border-radius: 4px; margin-right: 10px;">
                å½“å‰è½®è¯¢ä½ç½®: #${usageData.currentIndex}
              </span>
              <span style="background: #3498db; color: white; padding: 5px 12px; border-radius: 4px;">
                æ€»è¯·æ±‚æ•°: ${usageData.totalRequests}
              </span>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
              ${usageData.tokens.map(token => `
                <div style="padding: 15px; background: ${token.isCurrent ? '#e8f4fd' : '#f8f9fa'}; border-radius: 8px; border-left: 3px solid ${token.isCurrent ? '#3498db' : '#95a5a6'};">
                  <div style="color: #2c3e50; font-weight: 600; margin-bottom: 8px;">
                    Token #${token.index}
                    ${token.isCurrent ? '<span style="background: #3498db; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.75em; margin-left: 5px;">å½“å‰</span>' : ''}
                  </div>
                  <div style="color: #7f8c8d; font-size: 0.9em;">
                    <div>è¯·æ±‚æ¬¡æ•°: <strong style="color: #667eea;">${token.requests}</strong></div>
                    <div>æœ€åä½¿ç”¨: ${token.lastUsed ? new Date(token.lastUsed).toLocaleString() : 'ä»æœªä½¿ç”¨'}</div>
                  </div>
                </div>
              `).join('')}
            </div>
          `;
        }

        document.getElementById('systemInfo').innerHTML = `
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
            <div style="padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 3px solid #667eea;">
              <div style="color: #7f8c8d; font-size: 0.9em; margin-bottom: 5px;">Node ç‰ˆæœ¬</div>
              <div style="color: #2c3e50; font-weight: 600; font-size: 1.1em;">${data.nodeVersion}</div>
            </div>
            <div style="padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 3px solid #3498db;">
              <div style="color: #7f8c8d; font-size: 0.9em; margin-bottom: 5px;">å¹³å°</div>
              <div style="color: #2c3e50; font-weight: 600; font-size: 1.1em;">${data.platform}</div>
            </div>
            <div style="padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 3px solid #27ae60;">
              <div style="color: #7f8c8d; font-size: 0.9em; margin-bottom: 5px;">è¿›ç¨‹ PID</div>
              <div style="color: #2c3e50; font-weight: 600; font-size: 1.1em;">${data.pid}</div>
            </div>
            <div style="padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 3px solid #f39c12;">
              <div style="color: #7f8c8d; font-size: 0.9em; margin-bottom: 5px;">ç³»ç»Ÿå†…å­˜</div>
              <div style="color: #2c3e50; font-weight: 600; font-size: 1.1em;">${data.systemMemory}</div>
            </div>
          </div>
        `;
      } catch (error) {
        document.getElementById('systemInfo').innerHTML =
          `<div class="alert alert-error">åŠ è½½ç›‘æ§æ•°æ®å¤±è´¥: ${error.message}</div>`;
      }
    }

    // åŠ è½½ç³»ç»Ÿè®¾ç½®
    async function loadSettings() {
      try {
        const response = await authFetch(`${API_BASE}/admin/settings`);
        const settings = await response.json();

        // å¡«å……è¡¨å•
        document.getElementById('settingPort').value = settings.server?.port || '';
        document.getElementById('settingHost').value = settings.server?.host || '';
        document.getElementById('settingApiKey').value = settings.security?.apiKey || '';
        document.getElementById('settingAdminPassword').value = settings.security?.adminPassword || '';
        document.getElementById('settingMaxRequestSize').value = settings.security?.maxRequestSize || '';
        document.getElementById('settingTemperature').value = settings.defaults?.temperature || '';
        document.getElementById('settingTopP').value = settings.defaults?.top_p || '';
        document.getElementById('settingTopK').value = settings.defaults?.top_k || '';
        document.getElementById('settingMaxTokens').value = settings.defaults?.max_tokens || '';
        document.getElementById('settingSystemInstruction').value = settings.systemInstruction || '';
        document.getElementById('settingOAuthClientId').value = settings.oauth?.clientId || '';
        document.getElementById('settingOAuthClientSecret').value = settings.oauth?.clientSecret || '';
      } catch (error) {
        alert('åŠ è½½è®¾ç½®å¤±è´¥: ' + error.message);
      }
    }

    // ä¿å­˜ç³»ç»Ÿè®¾ç½®
    async function saveSettings() {
      try {
        const settings = {
          server: {
            port: parseInt(document.getElementById('settingPort').value) || 8045,
            host: document.getElementById('settingHost').value || '0.0.0.0'
          },
          security: {
            apiKey: document.getElementById('settingApiKey').value || 'sk-text',
            adminPassword: document.getElementById('settingAdminPassword').value || 'admin123',
            maxRequestSize: document.getElementById('settingMaxRequestSize').value || '50mb'
          },
          defaults: {
            temperature: parseFloat(document.getElementById('settingTemperature').value) || 1,
            top_p: parseFloat(document.getElementById('settingTopP').value) || 0.85,
            top_k: parseInt(document.getElementById('settingTopK').value) || 50,
            max_tokens: parseInt(document.getElementById('settingMaxTokens').value) || 8096
          },
          systemInstruction: document.getElementById('settingSystemInstruction').value || '',
          oauth: {
            clientId: document.getElementById('settingOAuthClientId').value || '',
            clientSecret: document.getElementById('settingOAuthClientSecret').value || ''
          }
        };

        const response = await authFetch(`${API_BASE}/admin/settings`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(settings)
        });

        const result = await response.json();
        if (response.ok) {
          alert(result.message || 'è®¾ç½®å·²ä¿å­˜ï¼è¯·é‡å¯æœåŠ¡å™¨ä»¥åº”ç”¨æ›´æ”¹ã€‚');
        } else {
          alert('ä¿å­˜å¤±è´¥: ' + (result.error || 'æœªçŸ¥é”™è¯¯'));
        }
      } catch (error) {
        alert('ä¿å­˜è®¾ç½®å¤±è´¥: ' + error.message);
      }
    }

    // æ·±è‰²æ¨¡å¼åˆ‡æ¢
    let currentLogs = [];
    let currentLogFilter = 'all';

    function toggleTheme() {
      const body = document.body;
      const icon = document.getElementById('themeIcon');

      if (body.classList.contains('dark-mode')) {
        body.classList.remove('dark-mode');
        icon.textContent = 'ğŸŒ™';
        localStorage.setItem('theme', 'light');
      } else {
        body.classList.add('dark-mode');
        icon.textContent = 'â˜€ï¸';
        localStorage.setItem('theme', 'dark');
      }
    }

    // æ—¥å¿—è¿‡æ»¤
    function filterLogs(level) {
      currentLogFilter = level;

      // æ›´æ–°æŒ‰é’®çŠ¶æ€
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.filter === level) {
          btn.classList.add('active');
        }
      });

      renderLogs();
    }

    // æ—¥å¿—æœç´¢
    function searchLogs(keyword) {
      renderLogs(keyword);
    }

    // æ¸²æŸ“æ—¥å¿—
    function renderLogs(searchKeyword = '') {
      const container = document.getElementById('logContainer');
      const search = searchKeyword || document.getElementById('logSearch')?.value || '';

      let filteredLogs = currentLogs;

      // æŒ‰çº§åˆ«è¿‡æ»¤
      if (currentLogFilter !== 'all') {
        filteredLogs = filteredLogs.filter(log => log.level === currentLogFilter);
      }

      // æŒ‰å…³é”®å­—æœç´¢
      if (search) {
        const keyword = search.toLowerCase();
        filteredLogs = filteredLogs.filter(log =>
          log.message.toLowerCase().includes(keyword) ||
          log.timestamp.toLowerCase().includes(keyword)
        );
      }

      if (filteredLogs.length === 0) {
        container.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">æ²¡æœ‰åŒ¹é…çš„æ—¥å¿—</div>';
        return;
      }

      container.innerHTML = filteredLogs.map(log => {
        let logClass = 'log-info';
        if (log.level === 'warn') logClass = 'log-warn';
        if (log.level === 'error') logClass = 'log-error';
        if (log.level === 'success') logClass = 'log-success';

        // é«˜äº®æœç´¢å…³é”®å­—
        let message = log.message;
        if (search) {
          const regex = new RegExp(`(${search})`, 'gi');
          message = message.replace(regex, '<mark style="background: #fef3c7; padding: 1px 3px; border-radius: 2px;">$1</mark>');
        }

        return `<div class="log-entry ${logClass}">${log.timestamp} [${log.level.toUpperCase()}] ${message}</div>`;
      }).join('');

      // æ›´æ–°ç»Ÿè®¡
      updateLogStats();
    }

    // æ›´æ–°æ—¥å¿—ç»Ÿè®¡
    function updateLogStats() {
      const stats = document.getElementById('logStats');
      if (currentLogs.length > 0) {
        stats.style.display = 'block';
        document.getElementById('logTotalCount').textContent = currentLogs.length;
        document.getElementById('logInfoCount').textContent = currentLogs.filter(l => l.level === 'info').length;
        document.getElementById('logSuccessCount').textContent = currentLogs.filter(l => l.level === 'success').length;
        document.getElementById('logWarnCount').textContent = currentLogs.filter(l => l.level === 'warn').length;
        document.getElementById('logErrorCount').textContent = currentLogs.filter(l => l.level === 'error').length;
      } else {
        stats.style.display = 'none';
      }
    }

    // å¯¼å‡ºæ—¥å¿—
    function exportLogs() {
      if (currentLogs.length === 0) {
        showToast('æ²¡æœ‰æ—¥å¿—å¯å¯¼å‡º', 'error');
        return;
      }

      const content = currentLogs.map(log =>
        `${log.timestamp} [${log.level.toUpperCase()}] ${log.message}`
      ).join('\n');

      const blob = new Blob([content], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `logs_${new Date().toISOString().split('T')[0]}.txt`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);

      showToast('æ—¥å¿—å·²å¯¼å‡º', 'success');
    }

    // å¤åˆ¶åˆ°å‰ªè´´æ¿
    async function copyToClipboard(text, button) {
      try {
        await navigator.clipboard.writeText(text);
        const originalText = button.textContent;
        button.textContent = 'å·²å¤åˆ¶!';
        button.classList.add('copied');

        setTimeout(() => {
          button.textContent = originalText;
          button.classList.remove('copied');
        }, 2000);

        showToast('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
      } catch (err) {
        showToast('å¤åˆ¶å¤±è´¥', 'error');
      }
    }

    // Token å¥åº·æ£€æŸ¥
    async function checkTokenHealth(index) {
      try {
        showToast('æ­£åœ¨æ£€æŸ¥ Token å¥åº·çŠ¶æ€...', 'info');

        const response = await authFetch(`${API_BASE}/admin/tokens/${index}/health`, {
          method: 'POST'
        });
        const result = await response.json();

        if (result.healthy) {
          showToast('Token çŠ¶æ€æ­£å¸¸', 'success');
        } else {
          showToast(`Token å¼‚å¸¸: ${result.error || 'æœªçŸ¥é”™è¯¯'}`, 'error');
        }

        loadTokens(); // åˆ·æ–°åˆ—è¡¨
      } catch (error) {
        showToast('å¥åº·æ£€æŸ¥å¤±è´¥: ' + error.message, 'error');
      }
    }

    // æ‰¹é‡æ“ä½œ Token
    async function batchToggleTokens(enable) {
      if (selectedTokens.size === 0) {
        alert('è¯·å…ˆé€‰æ‹©è¦æ“ä½œçš„è´¦å·');
        return;
      }

      const action = enable ? 'å¯ç”¨' : 'ç¦ç”¨';
      if (!confirm(`ç¡®å®šè¦${action}é€‰ä¸­çš„ ${selectedTokens.size} ä¸ªè´¦å·å—ï¼Ÿ`)) return;

      try {
        for (const index of selectedTokens) {
          await authFetch(`${API_BASE}/admin/tokens/${index}`, {
            method: 'PATCH',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ enable })
          });
        }

        showToast(`å·²${action} ${selectedTokens.size} ä¸ªè´¦å·`, 'success');
        selectedTokens.clear();
        loadTokens();
      } catch (error) {
        showToast(`æ‰¹é‡${action}å¤±è´¥: ${error.message}`, 'error');
      }
    }

    // æ‰¹é‡åˆ é™¤ Token
    async function batchDeleteTokens() {
      if (selectedTokens.size === 0) {
        alert('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„è´¦å·');
        return;
      }

      if (!confirm(`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${selectedTokens.size} ä¸ªè´¦å·å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼`)) return;

      try {
        // ä»å¤§åˆ°å°åˆ é™¤ï¼Œé¿å…ç´¢å¼•é—®é¢˜
        const sortedIndices = Array.from(selectedTokens).sort((a, b) => b - a);
        for (const index of sortedIndices) {
          await authFetch(`${API_BASE}/admin/tokens/${index}`, {
            method: 'DELETE'
          });
        }

        showToast(`å·²åˆ é™¤ ${selectedTokens.size} ä¸ªè´¦å·`, 'success');
        selectedTokens.clear();
        loadTokens();
      } catch (error) {
        showToast('æ‰¹é‡åˆ é™¤å¤±è´¥: ' + error.message, 'error');
      }
    }

    // å¿«æ·é”®æ”¯æŒ
    document.addEventListener('keydown', (e) => {
      // Ctrl+K: å¿«é€Ÿæœç´¢
      if (e.ctrlKey && e.key === 'k') {
        e.preventDefault();
        const logSearch = document.getElementById('logSearch');
        if (logSearch) {
          logSearch.focus();
        }
      }

      // Ctrl+D: åˆ‡æ¢æ·±è‰²æ¨¡å¼
      if (e.ctrlKey && e.key === 'd') {
        e.preventDefault();
        toggleTheme();
      }

      // Escape: æ¸…ç©ºæœç´¢
      if (e.key === 'Escape') {
        const logSearch = document.getElementById('logSearch');
        if (logSearch && document.activeElement === logSearch) {
          logSearch.value = '';
          searchLogs('');
        }
      }
    });

    // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', async () => {
      document.getElementById('baseUrl').textContent = API_BASE;

      // åŠ è½½ä¿å­˜çš„ä¸»é¢˜
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'dark') {
        document.body.classList.add('dark-mode');
        document.getElementById('themeIcon').textContent = 'â˜€ï¸';
      }

      // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
      const isLoggedIn = await verifySession();
      if (isLoggedIn) {
        document.getElementById('loginOverlay').classList.add('hidden');
        loadHomeData();

        // åŠ è½½é»˜è®¤APIå¯†é’¥åˆ°æµ‹è¯•å­—æ®µ
        try {
          const settingsResponse = await authFetch(`${API_BASE}/admin/settings`);
          const settings = await settingsResponse.json();
          if (settings.security?.apiKey) {
            document.getElementById('testApiKey').value = settings.security.apiKey;
          }
        } catch (e) {
          console.error('åŠ è½½é»˜è®¤APIå¯†é’¥å¤±è´¥:', e);
        }

        loadModels();
      } else {
        document.getElementById('loginOverlay').classList.remove('hidden');
      }
    });

    // ==================== å…¬å‘Šç®¡ç† ====================
    let uploadedImages = [];

    // åŠ è½½å…¬å‘Šåˆ—è¡¨
    async function loadAnnouncements() {
      try {
        const response = await authFetch(`${API_BASE}/admin/announcements`);
        const announcements = await response.json();
        const container = document.getElementById('announcementList');

        if (announcements.length === 0) {
          container.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">æš‚æ— å…¬å‘Š</div>';
          return;
        }

        container.innerHTML = announcements.map(ann => {
          const typeColors = {
            info: { bg: '#dbeafe', color: '#1e40af', label: 'ä¿¡æ¯' },
            success: { bg: '#d1fae5', color: '#065f46', label: 'æˆåŠŸ' },
            warning: { bg: '#fef3c7', color: '#92400e', label: 'è­¦å‘Š' },
            danger: { bg: '#fee2e2', color: '#991b1b', label: 'å±é™©' }
          };
          const typeStyle = typeColors[ann.type] || typeColors.info;

          return `
            <div style="background: #f8fafc; padding: 20px; border-radius: 12px; margin-bottom: 16px; border-left: 4px solid ${typeStyle.color};">
              <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                <div>
                  <h4 style="margin: 0 0 8px 0; color: #1e293b;">
                    ${ann.pinned ? '<span style="color: #f59e0b; margin-right: 5px;">ğŸ“Œ</span>' : ''}
                    ${ann.title}
                  </h4>
                  <div style="display: flex; gap: 8px; align-items: center;">
                    <span style="background: ${typeStyle.bg}; color: ${typeStyle.color}; padding: 2px 8px; border-radius: 4px; font-size: 0.8em;">${typeStyle.label}</span>
                    <span style="background: ${ann.enabled ? '#d1fae5' : '#fee2e2'}; color: ${ann.enabled ? '#065f46' : '#991b1b'}; padding: 2px 8px; border-radius: 4px; font-size: 0.8em;">${ann.enabled ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨'}</span>
                    <small style="color: #64748b;">${new Date(ann.created).toLocaleString()}</small>
                  </div>
                </div>
                <div style="display: flex; gap: 8px;">
                  <button onclick="toggleAnnouncement('${ann.id}', ${!ann.enabled})" style="padding: 6px 12px; border: none; border-radius: 6px; cursor: pointer; background: ${ann.enabled ? '#fef3c7' : '#d1fae5'}; color: ${ann.enabled ? '#92400e' : '#065f46'};">${ann.enabled ? 'ç¦ç”¨' : 'å¯ç”¨'}</button>
                  <button onclick="deleteAnnouncement('${ann.id}')" style="padding: 6px 12px; border: none; border-radius: 6px; cursor: pointer; background: #fee2e2; color: #991b1b;">åˆ é™¤</button>
                </div>
              </div>
              <p style="margin: 0; color: #475569; white-space: pre-wrap;">${ann.content}</p>
              ${ann.images && ann.images.length > 0 ? `
                <div style="display: flex; gap: 10px; margin-top: 12px; flex-wrap: wrap;">
                  ${ann.images.map(img => `<img src="${img}" style="max-width: 150px; max-height: 100px; border-radius: 8px; object-fit: cover;" onclick="window.open('${img}', '_blank')">`).join('')}
                </div>
              ` : ''}
            </div>
          `;
        }).join('');
      } catch (error) {
        console.error('åŠ è½½å…¬å‘Šå¤±è´¥:', error);
        document.getElementById('announcementList').innerHTML = `<div style="color: #ef4444; padding: 20px;">åŠ è½½å…¬å‘Šå¤±è´¥: ${error.message}</div>`;
      }
    }

    // åˆ›å»ºå…¬å‘Š
    async function createAnnouncement() {
      const title = document.getElementById('announcementTitle').value.trim();
      const content = document.getElementById('announcementContent').value.trim();
      const type = document.getElementById('announcementType').value;
      const pinned = document.getElementById('announcementPinned').checked;
      const resultEl = document.getElementById('createAnnouncementResult');

      if (!title || !content) {
        resultEl.innerHTML = '<div style="color: #ef4444;">è¯·å¡«å†™æ ‡é¢˜å’Œå†…å®¹</div>';
        return;
      }

      // å…ˆä¸Šä¼ å›¾ç‰‡
      const imageFiles = document.getElementById('announcementImages').files;
      const imageUrls = [];

      if (imageFiles.length > 0) {
        resultEl.innerHTML = '<div style="color: #3b82f6;">æ­£åœ¨ä¸Šä¼ å›¾ç‰‡...</div>';
        for (const file of imageFiles) {
          try {
            const formData = new FormData();
            formData.append('image', file);
            const uploadResponse = await fetch(`${API_BASE}/admin/announcements/upload`, {
              method: 'POST',
              headers: { 'X-Admin-Token': adminToken },
              body: formData
            });
            const uploadResult = await uploadResponse.json();
            if (uploadResult.url) {
              imageUrls.push(uploadResult.url);
            }
          } catch (e) {
            console.error('å›¾ç‰‡ä¸Šä¼ å¤±è´¥:', e);
          }
        }
      }

      try {
        resultEl.innerHTML = '<div style="color: #3b82f6;">æ­£åœ¨å‘å¸ƒå…¬å‘Š...</div>';
        const response = await authFetch(`${API_BASE}/admin/announcements`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ title, content, type, pinned, images: imageUrls })
        });

        const result = await response.json();
        if (response.ok) {
          resultEl.innerHTML = '<div style="color: #10b981;">å…¬å‘Šå‘å¸ƒæˆåŠŸ!</div>';
          document.getElementById('announcementTitle').value = '';
          document.getElementById('announcementContent').value = '';
          document.getElementById('announcementPinned').checked = false;
          document.getElementById('announcementImages').value = '';
          document.getElementById('imagePreview').innerHTML = '';
          loadAnnouncements();
          showToast('å…¬å‘Šå‘å¸ƒæˆåŠŸ', 'success');
        } else {
          resultEl.innerHTML = `<div style="color: #ef4444;">å‘å¸ƒå¤±è´¥: ${result.error}</div>`;
        }
      } catch (error) {
        resultEl.innerHTML = `<div style="color: #ef4444;">å‘å¸ƒå¤±è´¥: ${error.message}</div>`;
      }
    }

    // åˆ‡æ¢å…¬å‘Šå¯ç”¨çŠ¶æ€
    async function toggleAnnouncement(id, enabled) {
      try {
        await authFetch(`${API_BASE}/admin/announcements/${id}`, {
          method: 'PATCH',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ enabled })
        });
        loadAnnouncements();
        showToast(enabled ? 'å…¬å‘Šå·²å¯ç”¨' : 'å…¬å‘Šå·²ç¦ç”¨', 'success');
      } catch (error) {
        showToast('æ“ä½œå¤±è´¥: ' + error.message, 'error');
      }
    }

    // åˆ é™¤å…¬å‘Š
    async function deleteAnnouncement(id) {
      if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡å…¬å‘Šå—ï¼Ÿ')) return;
      try {
        await authFetch(`${API_BASE}/admin/announcements/${id}`, {
          method: 'DELETE'
        });
        loadAnnouncements();
        showToast('å…¬å‘Šå·²åˆ é™¤', 'success');
      } catch (error) {
        showToast('åˆ é™¤å¤±è´¥: ' + error.message, 'error');
      }
    }

    // å›¾ç‰‡é¢„è§ˆ
    document.getElementById('announcementImages')?.addEventListener('change', function(e) {
      const preview = document.getElementById('imagePreview');
      preview.innerHTML = '';
      for (const file of this.files) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const img = document.createElement('img');
          img.src = e.target.result;
          img.style.cssText = 'max-width: 100px; max-height: 80px; border-radius: 8px; object-fit: cover;';
          preview.appendChild(img);
        };
        reader.readAsDataURL(file);
      }
    });

    // ==================== ç”¨æˆ·ç®¡ç† ====================
    async function loadUsers() {
      try {
        const response = await authFetch(`${API_BASE}/admin/users`);
        const data = await response.json();
        const users = data.users || [];

        // æ›´æ–°ç»Ÿè®¡
        document.getElementById('totalUsers').textContent = users.length;
        document.getElementById('activeUsers').textContent = users.filter(u => u.enabled !== false).length;
        document.getElementById('sharedTokensCount').textContent = users.reduce((sum, u) =>
          sum + (u.googleTokens || []).filter(t => t.isShared).length, 0);
        document.getElementById('todayCalls').textContent = users.reduce((sum, u) =>
          sum + (u.googleTokens || []).reduce((s, t) => s + (t.usageToday || 0), 0), 0);

        const container = document.getElementById('userList');
        if (users.length === 0) {
          container.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">æš‚æ— ç”¨æˆ·</div>';
          return;
        }

        container.innerHTML = users.map(user => {
          const tokens = user.googleTokens || [];
          const sharedCount = tokens.filter(t => t.isShared).length;
          const totalUsage = tokens.reduce((sum, t) => sum + (t.usageToday || 0), 0);

          return `
            <div style="background: #f8fafc; padding: 16px; border-radius: 12px; margin-bottom: 12px; border: 1px solid #e2e8f0;">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <strong style="color: #1e293b;">${user.username}</strong>
                  <span style="background: ${user.enabled !== false ? '#d1fae5' : '#fee2e2'}; color: ${user.enabled !== false ? '#065f46' : '#991b1b'}; padding: 2px 8px; border-radius: 4px; font-size: 0.75em; margin-left: 8px;">${user.enabled !== false ? 'æ­£å¸¸' : 'å·²ç¦ç”¨'}</span>
                </div>
                <div style="display: flex; gap: 8px;">
                  <span style="background: #dbeafe; color: #1e40af; padding: 4px 10px; border-radius: 6px; font-size: 0.85em;">Token: ${tokens.length}</span>
                  <span style="background: #d1fae5; color: #065f46; padding: 4px 10px; border-radius: 6px; font-size: 0.85em;">å…±äº«: ${sharedCount}</span>
                  <span style="background: #fef3c7; color: #92400e; padding: 4px 10px; border-radius: 6px; font-size: 0.85em;">ä»Šæ—¥: ${totalUsage}</span>
                </div>
              </div>
              <div style="margin-top: 8px; color: #64748b; font-size: 0.85em;">
                åˆ›å»ºæ—¶é—´: ${new Date(user.created).toLocaleString()}
                ${user.lastLogin ? ` Â· æœ€åç™»å½•: ${new Date(user.lastLogin).toLocaleString()}` : ''}
              </div>
            </div>
          `;
        }).join('');
      } catch (error) {
        console.error('åŠ è½½ç”¨æˆ·å¤±è´¥:', error);
        document.getElementById('userList').innerHTML = `<div style="color: #ef4444; padding: 20px;">åŠ è½½ç”¨æˆ·å¤±è´¥: ${error.message}</div>`;
      }
    }

    // ==================== AI ç®¡ç† ====================

    // åŠ è½½AIé…ç½®
    async function loadAIConfig() {
      try {
        const res = await fetch('/admin/ai/config', {
          headers: { 'X-Admin-Session': sessionToken }
        });
        const config = await res.json();

        document.getElementById('aiEnabled').checked = config.enabled || false;
        document.getElementById('aiApiEndpoint').value = config.apiEndpoint || '';
        document.getElementById('aiApiKey').value = config.apiKey || '';
        document.getElementById('aiModel').value = config.model || 'gemini-2.0-flash-exp';
        document.getElementById('aiCheckInterval').value = config.checkIntervalHours || 1;
        document.getElementById('aiThreshold').value = config.autoModerateThreshold || 0.8;
        document.getElementById('aiThresholdValue').textContent = config.autoModerateThreshold || 0.8;
        document.getElementById('aiSystemPrompt').value = config.systemPrompt || '';

        // åŠ è½½ç»Ÿè®¡ä¿¡æ¯
        await loadAIStatistics();
      } catch (error) {
        console.error('åŠ è½½AIé…ç½®å¤±è´¥:', error);
        showMessage('åŠ è½½AIé…ç½®å¤±è´¥: ' + error.message, 'error');
      }
    }

    // ä¿å­˜AIé…ç½®
    async function saveAIConfig() {
      try {
        const config = {
          enabled: document.getElementById('aiEnabled').checked,
          apiEndpoint: document.getElementById('aiApiEndpoint').value,
          apiKey: document.getElementById('aiApiKey').value,
          model: document.getElementById('aiModel').value,
          checkIntervalHours: parseInt(document.getElementById('aiCheckInterval').value),
          autoModerateThreshold: parseFloat(document.getElementById('aiThreshold').value),
          systemPrompt: document.getElementById('aiSystemPrompt').value
        };

        const res = await fetch('/admin/ai/config', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-Admin-Session': sessionToken
          },
          body: JSON.stringify(config)
        });

        const result = await res.json();
        if (result.success) {
          showMessage('AIé…ç½®å·²ä¿å­˜', 'success');
          await loadAIConfig();
        } else {
          showMessage('ä¿å­˜å¤±è´¥: ' + result.message, 'error');
        }
      } catch (error) {
        console.error('ä¿å­˜AIé…ç½®å¤±è´¥:', error);
        showMessage('ä¿å­˜AIé…ç½®å¤±è´¥: ' + error.message, 'error');
      }
    }

    // æ‰‹åŠ¨è¿è¡ŒAIå®¡æ ¸
    async function runAIModeration() {
      try {
        showMessage('æ­£åœ¨è¿è¡ŒAIå®¡æ ¸ï¼Œè¯·ç¨å€™...', 'info');

        const res = await fetch('/admin/ai/run', {
          method: 'POST',
          headers: {
            'X-Admin-Session': sessionToken
          }
        });

        const result = await res.json();
        if (result.success) {
          showMessage(`AIå®¡æ ¸å®Œæˆï¼æ£€æŸ¥${result.totalChecked}ä¸ªç”¨æˆ·ï¼Œå°ç¦${result.bannedCount}ä¸ªï¼Œæ ‡è®°${result.flaggedCount}ä¸ª`, 'success');
          await loadAILogs();
          await loadAIStatistics();
        } else {
          showMessage('å®¡æ ¸å¤±è´¥: ' + result.message, 'error');
        }
      } catch (error) {
        console.error('è¿è¡ŒAIå®¡æ ¸å¤±è´¥:', error);
        showMessage('è¿è¡ŒAIå®¡æ ¸å¤±è´¥: ' + error.message, 'error');
      }
    }

    // åŠ è½½AIæ—¥å¿—
    async function loadAILogs() {
      try {
        const res = await fetch('/admin/ai/logs?limit=50', {
          headers: { 'X-Admin-Session': sessionToken }
        });
        const data = await res.json();
        const logs = data.logs || [];

        const container = document.getElementById('aiLogsList');
        if (logs.length === 0) {
          container.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">æš‚æ— å®¡æ ¸è®°å½•</div>';
          return;
        }

        container.innerHTML = logs.map(log => {
          const date = new Date(log.timestamp).toLocaleString();
          let content = '';
          let color = '#64748b';

          if (log.action === 'moderation_completed') {
            const s = log.summary;
            color = '#10b981';
            content = `å®Œæˆå®¡æ ¸ï¼šæ£€æŸ¥ ${s.totalChecked} ä¸ªç”¨æˆ·ï¼Œå°ç¦ ${s.bannedCount} ä¸ªï¼Œæ ‡è®° ${s.flaggedCount} ä¸ªï¼Œè€—æ—¶ ${Math.round(s.durationMs/1000)}s`;
          } else if (log.action === 'auto_banned') {
            color = '#ef4444';
            content = `è‡ªåŠ¨å°ç¦ç”¨æˆ· ${log.username}ï¼š${log.reason}ï¼ˆç½®ä¿¡åº¦: ${log.confidence}ï¼‰- ç¬¬${log.banCount}æ¬¡å°ç¦ï¼Œ${log.banDays}å¤©`;
          } else if (log.action === 'flagged') {
            color = '#f59e0b';
            content = `æ ‡è®°ç”¨æˆ· ${log.username}ï¼š${log.reason}ï¼ˆç½®ä¿¡åº¦: ${log.confidence}ï¼‰`;
          } else if (log.action === 'analysis_failed') {
            color = '#ef4444';
            content = `åˆ†æç”¨æˆ· ${log.username} å¤±è´¥ï¼š${log.error}`;
          } else {
            content = JSON.stringify(log);
          }

          return `
            <div style="border-left: 3px solid ${color}; padding: 12px; margin-bottom: 8px; background: #f8fafc; border-radius: 6px;">
              <div style="color: ${color}; font-weight: 500; margin-bottom: 4px;">${content}</div>
              <div style="color: #94a3b8; font-size: 0.85em;">${date}</div>
            </div>
          `;
        }).join('');
      } catch (error) {
        console.error('åŠ è½½AIæ—¥å¿—å¤±è´¥:', error);
        document.getElementById('aiLogsList').innerHTML = `<div style="color: #ef4444; padding: 20px;">åŠ è½½å¤±è´¥: ${error.message}</div>`;
      }
    }

    // åŠ è½½AIç»Ÿè®¡ä¿¡æ¯
    async function loadAIStatistics() {
      try {
        const res = await fetch('/admin/ai/statistics', {
          headers: { 'X-Admin-Session': sessionToken }
        });
        const stats = await res.json();

        document.getElementById('aiTotalRuns').textContent = stats.totalRuns || 0;
        document.getElementById('aiTotalBanned').textContent = stats.totalBanned || 0;
        document.getElementById('aiTotalFlagged').textContent = stats.totalFlagged || 0;
        document.getElementById('aiAvgDuration').textContent = stats.avgDuration ? `${Math.round(stats.avgDuration/1000)}s` : '0s';
      } catch (error) {
        console.error('åŠ è½½AIç»Ÿè®¡å¤±è´¥:', error);
      }
    }

    // ç½®ä¿¡åº¦æ»‘å—æ›´æ–°
    document.getElementById('aiThreshold')?.addEventListener('input', function() {
      document.getElementById('aiThresholdValue').textContent = this.value;
    });

    // å½“åˆ‡æ¢åˆ°AIæ ‡ç­¾æ—¶åŠ è½½æ•°æ®
    const originalSwitchTab = window.switchTab;
    window.switchTab = function(tabName) {
      originalSwitchTab(tabName);
      if (tabName === 'ai') {
        loadAIConfig();
        loadAILogs();
      }
    };
  </script>
</body>
</html>
